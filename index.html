<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Estudio: Riesgos Bancarios (Local)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        const appId = 'riesgos-bancarios-app-local-v5'; // Namespace for localStorage, v4 for new features
        let preguntasGlobal = [];

        const TEMAS_NOMBRES = [
            "Tema 1: Fundamentos de Riesgos y Adecuación de Capital",
            "Tema 2: Gestión del Riesgo de Crédito: Particulares",
            "Tema 3: Análisis de Estados Financieros",
            "Tema 4: Gestión del Riesgo de Crédito: Empresas, Seguimiento y Morosidad",
            "Tema 5: Riesgos de Productos de Activo",
            "Tema 6: Concesión de Operaciones a Personas Físicas: Consumo/Hipotecario",
            "Tema 7: Concesión de Operaciones a Personas Físicas: Negocios",
            "Tema 8: Concesión de Operaciones a Personas Jurídicas: Microempresas",
            "Tema 9: Concesión de Operaciones al Sector Agrícola",
            "Tema 10: Formalización, Seguimiento, Morosidad y Acción Recuperadora"
        ];

        async function cargarPreguntas() {
            preguntasGlobal = [
                // --- TEMA 1: Fundamentos de Riesgos y Adecuación de Capital ---

                // From eva test.docx
                { id: "eva_t1_p1", tema: 1, origen: "eva test", texto: "La definición, actualización y supervisión del cumplimiento del marco de apetito al riesgo, es una responsabilidad del:", opciones: [{ texto: "Dirección de Riesgos.", esCorrecta: false }, { texto: "Comité de Activos y Pasivos.", esCorrecta: false }, { texto: "Consejo de Administración.", esCorrecta: true }, { texto: "Dirección General.", esCorrecta: false }] },
                { id: "eva_t1_p2", tema: 1, origen: "eva test", texto: "La pérdida o disminución de rentabilidad a consecuencias de modificaciones en el marco regulatorio por fallos judiciales desfavorables para la entidad se tipifica como:", opciones: [{ texto: "Riesgo Legal y regulatorio.", esCorrecta: true }, { texto: "Riesgo de Conducta.", esCorrecta: false }, { texto: "Riesgo Soberano.", esCorrecta: false }, { texto: "Riesgo Reputacional.", esCorrecta: false }] },
                { id: "eva_t1_p4", tema: 1, origen: "eva test", texto: "La cultura de riesgos:", opciones: [{ texto: "Supone la aplicación de los acuerdos alcanzados por la Asociación Española de Banca, que son vinculantes para la entidad.", esCorrecta: false }, { texto: "Comprende una serie de actitudes, valores, habilidades y pautas de actuación frente a los riesgos.", esCorrecta: true }, { texto: "Es el conjunto de normas sobre riesgos, establecidas por el Banco de España.", esCorrecta: false }, { texto: "Corresponde a la aplicación exhaustiva de las normas internas y recomendaciones de la auditoria, en el ámbito de riesgos.", esCorrecta: false }] },
                { id: "eva_t1_p5", tema: 1, origen: "eva test", texto: "Las entidades que no cumplan los requisitos mínimos de capital ordinario de nivel 1 (se encuentren por debajo del umbral de referencia)", opciones: [{ texto: "Deben provisionar de inmediato todos sus créditos morosos.", esCorrecta: false }, { texto: "Estarán sujetas a restricciones en el reparto de beneficios.", esCorrecta: true }, { texto: "Serán supervisadas directamente por el BCE.", esCorrecta: false }, { texto: "Pueden aumentar su capital emitiendo productos híbridos.", esCorrecta: false }] },
                { id: "eva_t1_p11", tema: 1, origen: "eva test", texto: "Las acciones ordinarias emitidas por la entidad y totalmente desembolsadas forman parte del capital:", opciones: [{ texto: "Adicional de nivel 2.", esCorrecta: false }, { texto: "Ordinario de nivel 1.", esCorrecta: true }, { texto: "Adicional de nivel 1.", esCorrecta: false }, { texto: "Ordinario de nivel 2.", esCorrecta: false }] },
                { id: "eva_t1_p12", tema: 1, origen: "eva test", texto: "Cuando se observa que los resultados reales sobre el comportamiento de un determinado riesgo (mercado, divisas, crédito, etc.) difieren de los datos previstos, como consecuencia de una incorrecta definición de los parámetros, datos y/o métricas cuantitativas empleados en la hipótesis inicial, decimos que estamos incurriendo en un:", opciones: [{ texto: "Riesgo reputacional.", esCorrecta: false }, { texto: "Riesgo conducta y cumplimento.", esCorrecta: false }, { texto: "Riesgo modelo.", esCorrecta: true }, { texto: "Riesgo tecnológico.", esCorrecta: false }] },

                // From Preguntas&Respuestas.docx (Example, more would be added)
                { id: "pr_t1_p1", tema: 1, origen: "Preguntas&Respuestas", texto: "El riesgo de tipo de interés puede ser más acusado en una entidad, cuando:", opciones: [{ texto: "Existe un GAP (brecha) importante ente los plazos residuales o de revaluación (tiempo hasta el vencimiento o revisión) de las operaciones de activo y las de captación de pasivo.", esCorrecta: true }, { texto: "Suben los tipos de interés.", esCorrecta: false }, { texto: "Cuando bajan los tipos de interés.", esCorrecta: false }, { texto: "La entidad tiene muchos productos a tipo fijo.", esCorrecta: false }] },
                { id: "pr_t1_p2", tema: 1, origen: "Preguntas&Respuestas", texto: "El establecimiento de los limites globales de riesgo y la definición del apetito de riesgo es una competencia de:", opciones: [{ texto: "Consejo de Administración.", esCorrecta: true }, { texto: "Dirección de Riesgos.", esCorrecta: false }, { texto: "Comité de Auditoría.", esCorrecta: false }, { texto: "Banco Central.", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t1_p2", tema: 1, origen: "Test Alberto", texto: "Un instrumento subordinado emitido por la entidad con un vencimiento de 7 años no asegurado por el emisor ¿puede computar como capital regulatorio?", opciones: [{ texto: "Sí, pero como capital de nivel 2.", esCorrecta: true }, { texto: "Sí, pero como capital adicional de nivel 1.", esCorrecta: false }, { texto: "Sí, pero como capital de nivel 3.", esCorrecta: false }, { texto: "No, puesto que se trata de un producto híbrido.", esCorrecta: false }] },
                { id: "alb_t1_p4", tema: 1, origen: "Test Alberto", texto: "La posibilidad presente y futura de que las ganancias o el patrimonio de la entidad se vean perjudicados por una opinión pública negativa, tanto si esta tiene fundamento como si no lo tiene, se tipifica como:", opciones: [{ texto: "Riesgo reputacional.", esCorrecta: true }, { texto: "Riesgo operacional.", esCorrecta: false }, { texto: "Riesgo conducta y cumplimiento.", esCorrecta: false }, { texto: "Riesgo tecnológico.", esCorrecta: false }] },

                // From TEST ALFONSO.docx
                { id: "alf_t1_p2", tema: 1, origen: "TEST ALFONSO", texto: "El cociente entre el rendimiento ajustado por riesgo y el capital ajustado por riesgo se denomina:", opciones: [{ texto: "ROE (Return on equity).", esCorrecta: false }, { texto: "RARORAC (Risk-adjusted return on risk-adjusted capital).", esCorrecta: true }, { texto: "RORAC (Return on risk-adjusted capital).", esCorrecta: false }, { texto: "RAROC (Risk-adjusted return on capital).", esCorrecta: false }] },
                { id: "alf_t1_p11", tema: 1, origen: "TEST ALFONSO", texto: "En el marco de Basilea III, el capital de liquidación (‘gone-concern capital’) se corresponde con:", opciones: [{ texto: "El colchón adicional de capital.", esCorrecta: false }, { texto: "El capital desembolsado.", esCorrecta: false }, { texto: "El capital de nivel 2.", esCorrecta: true }, { texto: "El capital de nivel 1.", esCorrecta: false }] },

                // From Test Guaci.docx
                { id: "gua_t1_p1", tema: 1, origen: "Test Guaci", texto: "El riesgo actuarial es el resultante de:", opciones: [{ texto: "Menoscabo de la capacidad competitiva, por deterioro de la confianza en la entidad.", esCorrecta: false }, { texto: "Restricción de la capacidad de la Entidad Financiera para adaptar su volumen de recursos propios a las exigencias normativas.", esCorrecta: false }, { texto: "La pérdida de valor de los activos de la entidad frente a un cliente, por el deterioro de su capacidad de hacer frente a sus compromisos.", esCorrecta: false }, { texto: "Incremento del valor de los compromisos contraídos por contratos de seguro con clientes y por pensiones con empleados a raíz de la divergencia entre las estimaciones de siniestralidad y tipos y la evolución real de estas magnitudes.", esCorrecta: true }] },
                { id: "gua_t1_p7", tema: 1, origen: "Test Guaci", texto: "El Mecanismo Único de Supervisión (MUS) tiene por objetivo:", opciones: [{ texto: "Mutualizar las pérdidas en los posibles rescates bancarios.", esCorrecta: false }, { texto: "Someter a las entidades significativas a la supervisión directa del BCE.", esCorrecta: true }, { texto: "Coordinar la actuación de los auditores internos de las entidades de la UEM.", esCorrecta: false }, { texto: "Imponer los requisitos de absorción de pérdidas.", esCorrecta: false }] },

                // From Test Jenny.docx
                { id: "jen_t1_p2", tema: 1, origen: "Test Jenny", texto: "La metodología que utilizan las entidades financieras para realizar el análisis de sensibilidad del margen financiero y del valor patrimonial, ante las variaciones de los tipos de interés, se sustenta en:", opciones: [{ texto: "Analizar el gap de tipos de interés de los activos y pasivos.", esCorrecta: false }, { texto: "Valorar la sensibilidad del valor económico.", esCorrecta: false }, { texto: "Todas las otras respuestas son correctas.", esCorrecta: true }, { texto: "Valorar la sensibilidad del margen financiero.", esCorrecta: false }] },
                { id: "jen_t1_p15", tema: 1, origen: "Test Jenny", texto: "Los nuevos «colchones» de capital, que se establecen con los acuerdos de Basilea III, se denominan:", opciones: [{ texto: "De pérdida esperada.", esCorrecta: false }, { texto: "De pérdida inesperada.", esCorrecta: false }, { texto: "De capital anticíclico. De conservación de capital.", esCorrecta: true }, { texto: "De patrimonio neto. De capital regulatorio.", esCorrecta: false }, { texto: "De solvencia. De liquidez.", esCorrecta: false }] },

                // From TEST Luci.docx
                { id: "luc_t1_p1", tema: 1, origen: "TEST Luci", texto: "La probabilidad de que un cliente no atienda sus obligaciones contractuales durante un periodo superior a 90 días se define como:", opciones: [{ texto: "Pérdida esperada (PE).", esCorrecta: false }, { texto: "Severidad (LGD).", esCorrecta: false }, { texto: "Exposición (EAD).", esCorrecta: false }, { texto: "Probabilidad de incumplimiento (PD).", esCorrecta: true }] },
                { id: "luc_t1_p12", tema: 1, origen: "TEST Luci", texto: "Las acciones ordinarias emitidas por la entidad y totalmente desembolsadas forman parte del capital:", opciones: [{ texto: "Adicional de nivel 1.", esCorrecta: false }, { texto: "Adicional de nivel 2.", esCorrecta: false }, { texto: "Ordinario de nivel 2.", esCorrecta: false }, { texto: "Ordinario de nivel 1.", esCorrecta: true }] },

                // From Test Miguel.docx
                { id: "mig_t1_p1", tema: 1, origen: "Test Miguel", texto: "La cultura de riesgos:", opciones: [{ texto: "Corresponde a la aplicación exhaustiva de las normas internas y recomendaciones de la auditoria, en el ámbito de riesgos.", esCorrecta: false }, { texto: "Comprende una serie de actitudes, valores, habilidades y pautas de actuación frente a los riesgos.", esCorrecta: true }, { texto: "Es el conjunto de normas sobre riesgos, establecidas por el Banco de España.", esCorrecta: false }, { texto: "Supone la aplicación de los acuerdos alcanzados por la Asociación Española de Banca, que son vinculantes para la entidad.", esCorrecta: false }] },
                { id: "mig_t1_p5", tema: 1, origen: "Test Miguel", texto: "La ratio de apalancamiento (‘leverage ratio’), prevista en Basilea III se define como el cociente entre:", opciones: [{ texto: "Recursos propios y el valor de exposición de total activo contable.", esCorrecta: false }, { texto: "El capital de nivel 1 y los recursos propios.", esCorrecta: false }, { texto: "El capital de nivel 1 y el valor de exposición del total activo contable más las cuentas de orden (avales, límites de crédito, etc.)", esCorrecta: true }, { texto: "Recursos propios y el valor de exposición de los activos ponderados en riesgo.", esCorrecta: false }] },

                // From Test Minaya 1-10.docx
                { id: "min_t1_p1", tema: 1, origen: "Test Minaya", texto: "La creación de valor de una operación o cliente se define como:", opciones: [{ texto: "El exceso de garantías sobre el nominal de la operación.", esCorrecta: false }, { texto: "El margen que se obtiene una vez descontada la pérdida esperada.", esCorrecta: false }, { texto: "El potencial comercial que tiene el cliente para nuevas operaciones.", esCorrecta: false }, { texto: "El margen que se obtiene una vez retribuido el coste de capital empleado.", esCorrecta: true }] },
                { id: "min_t1_p7", tema: 1, origen: "Test Minaya", texto: "Una de las principales ventajas de la metodología IRB (‘internal ratings based’) es que:", opciones: [{ texto: "Consume menos recursos propios que el método estándar.", esCorrecta: true }, { texto: "Resulta más rápida su implantación.", esCorrecta: false }, { texto: "No requiere de ninguna aprobación por parte del supervisor.", esCorrecta: false }, { texto: "No es necesaria la comunicación posterior de las operaciones aprobadas.", esCorrecta: false }] },

                // From Test Wenceslao.docx
                { id: "wen_t1_p1", tema: 1, origen: "Test Wenceslao", texto: "De acuerdo al Pilar III de los acuerdos de Basilea, las entidades están obligadas a publicar un informe explicativo de las medidas aplicadas para la adecuación y evaluación interna de la liquidez, denominado:", opciones: [{ texto: "Informe de Liquidez.", esCorrecta: false }, { texto: "Informe del Pilar III.", esCorrecta: false }, { texto: "Informe de Relevancia Prudencial.", esCorrecta: true }, { texto: "Informe de Solvencia.", esCorrecta: false }] },
                { id: "wen_t1_p9", tema: 1, origen: "Test Wenceslao", texto: "Un instrumento subordinado emitido por la entidad con un vencimiento de 7 años no asegurado por el emisor ¿puede computar como capital regulatorio?", opciones: [{ texto: "No, puesto que se trata de un producto híbrido.", esCorrecta: false }, { texto: "Sí, pero como capital adicional de nivel 1.", esCorrecta: false }, { texto: "Sí, pero como capital de nivel 3.", esCorrecta: false }, { texto: "Sí, pero como capital de nivel 2.", esCorrecta: true }] },

                // Generated for Tema 1
                { id: "gen_t1_p1", tema: 1, origen: "Generada", texto: "¿Cuál es el propósito principal del 'colchón de conservación de capital' introducido en Basilea III?", opciones: [{ texto: "Permitir a los bancos asumir más riesgo en épocas de bonanza.", esCorrecta: false }, { texto: "Asegurar que los bancos mantengan un nivel mínimo de capital para absorber pérdidas durante periodos de estrés financiero.", esCorrecta: true }, { texto: "Financiar la expansión internacional de las entidades.", esCorrecta: false }, { texto: "Reducir la necesidad de supervisión por parte del Banco Central.", esCorrecta: false }] },
                { id: "gen_t1_p2", tema: 1, origen: "Generada", texto: "El Riesgo Operacional, según Basilea II, incluye las pérdidas derivadas de:", opciones: [{ texto: "Fluctuaciones adversas en los tipos de interés.", esCorrecta: false }, { texto: "Incumplimiento de pago por parte de un prestatario.", esCorrecta: false }, { texto: "Procesos internos inadecuados, fallos humanos, sistemas defectuosos o eventos externos.", esCorrecta: true }, { texto: "Cambios en la cotización de las acciones en cartera.", esCorrecta: false }] },
                { id: "gen_t1_p3", tema: 1, origen: "Generada", texto: "La segunda línea de defensa en el modelo de gestión de riesgos de una entidad financiera típicamente corresponde a:", opciones: [{ texto: "Las unidades de negocio que originan el riesgo.", esCorrecta: false }, { texto: "La función de Auditoría Interna.", esCorrecta: false }, { texto: "Las funciones de control de riesgos y cumplimiento normativo.", esCorrecta: true }, { texto: "El Consejo de Administración.", esCorrecta: false }] },
                { id: "gen_t1_p4", tema: 1, origen: "Generada", texto: "El 'Stress Testing' es una herramienta utilizada para:", opciones: [{ texto: "Evaluar la rentabilidad diaria de la cartera de negociación.", esCorrecta: false }, { texto: "Medir el impacto de escenarios extremos pero plausibles sobre la solvencia y liquidez de la entidad.", esCorrecta: true }, { texto: "Determinar la calificación crediticia de los clientes corporativos.", esCorrecta: false }, { texto: "Optimizar la asignación de capital entre las diferentes líneas de negocio.", esCorrecta: false }] },
                { id: "gen_t1_p5", tema: 1, origen: "Generada", texto: "¿Qué es el Riesgo de Concentración?", opciones: [{ texto: "El riesgo de que demasiados empleados se concentren en una sola oficina.", esCorrecta: false }, { texto: "El riesgo derivado de una exposición excesiva a una única contraparte, sector económico, región geográfica o tipo de activo.", esCorrecta: true }, { texto: "El riesgo de que la entidad se concentre únicamente en productos de bajo rendimiento.", esCorrecta: false }, { texto: "El riesgo de que la concentración de CO2 en la atmósfera afecte las inversiones verdes del banco.", esCorrecta: false }] },
                { id: "gen_t1_p6", tema: 1, origen: "Generada", texto: "El Capital Regulatorio Mínimo se exige para:", opciones: [{ texto: "Garantizar que los bancos puedan pagar dividendos elevados.", esCorrecta: false }, { texto: "Cubrir las pérdidas esperadas de la actividad crediticia.", esCorrecta: false }, { texto: "Asegurar la capacidad del banco para absorber pérdidas inesperadas y proteger a los depositantes.", esCorrecta: true }, { texto: "Financiar la compra de nuevas tecnologías.", esCorrecta: false }] },
                { id: "gen_t1_p7", tema: 1, origen: "Generada", texto: "La diferencia fundamental entre el método estándar y el método IRB para el cálculo del capital por riesgo de crédito radica en:", opciones: [{ texto: "El método estándar no requiere aprobación del supervisor.", esCorrecta: false }, { texto: "El método IRB permite a los bancos utilizar sus propias estimaciones internas de parámetros de riesgo (PD, LGD, EAD) previa validación supervisora.", esCorrecta: true }, { texto: "El método IRB solo se aplica a carteras de renta fija.", esCorrecta: false }, { texto: "El método estándar consume siempre más capital regulatorio.", esCorrecta: false }] },
                { id: "gen_t1_p8", tema: 1, origen: "Generada", texto: "¿Cuál de los siguientes NO es un tipo de riesgo financiero principal?", opciones: [{ texto: "Riesgo de Mercado.", esCorrecta: false }, { texto: "Riesgo de Crédito.", esCorrecta: false }, { texto: "Riesgo de Liquidez.", esCorrecta: false }, { texto: "Riesgo Estratégico.", esCorrecta: true }] },
                { id: "gen_t1_p9", tema: 1, origen: "Generada", texto: "El Pilar II del Acuerdo de Basilea se centra en:", opciones: [{ texto: "Los requisitos mínimos de capital.", esCorrecta: false }, { texto: "La disciplina de mercado a través de la divulgación de información.", esCorrecta: false }, { texto: "El proceso de supervisión bancaria y la evaluación de la adecuación del capital interno de las entidades (ICAAP).", esCorrecta: true }, { texto: "La estandarización de los modelos de riesgo operacional.", esCorrecta: false }] },
                { id: "gen_t1_p10", tema: 1, origen: "Generada", texto: "Un ejemplo de Riesgo de Conducta sería:", opciones: [{ texto: "Una pérdida por un ciberataque.", esCorrecta: false }, { texto: "La venta de productos financieros no adecuados al perfil del cliente para alcanzar objetivos comerciales.", esCorrecta: true }, { texto: "El impago de un préstamo por parte de una empresa debido a una crisis sectorial.", esCorrecta: false }, { texto: "Una caída en el valor de la cartera de acciones debido a movimientos del mercado.", esCorrecta: false }] },

                // --- TEMA 2: Gestión del Riesgo de Crédito: Particulares ---
                // From eva test.docx
                { id: "eva_t2_p1", tema: 2, origen: "eva test", texto: "En el caso de las empresas, ¿cómo se denomina la ficha o hoja de cálculo, que debemos solicitar al cliente para el estudio de una operación de financiación, donde se reflejan las diferentes posiciones de riesgos que tiene el cliente con las otras entidades?", opciones: [{ texto: "Información que cotejaremos con la CIRBE.", esCorrecta: false }, { texto: "Pool de bancos.", esCorrecta: true }, { texto: "No deberíamos pedir esta información al cliente, ya que es una información confidencial sobre nuestros competidores.", esCorrecta: false }, { texto: "Badexcug.", esCorrecta: false }, { texto: "Plan Estratégico.", esCorrecta: false}] },
                { id: "eva_t2_p6", tema: 2, origen: "eva test", texto: "Con la muerte de un fiador de una operación de financiación:", opciones: [{ texto: "Solo se extinguirá cuando se cumpla la obligación del deudor afianzado y únicamente pasará a formar parte de la masa hereditaria si no está al corriente de pago.", esCorrecta: false }, { texto: "Se extingue el afianzamiento en el momento de la defunción.", esCorrecta: false }, { texto: "Se debe esperar al vencimiento de la operación financiada, para tomar las decisiones oportunas, ya que el afianzamiento no prescribe.", esCorrecta: false }, { texto: "Solo extinguirá cuando se cumpla la obligación del deudor afianzado y pasará a formar parte de la masa hereditaria, tanto si está o no al corriente de pago.", esCorrecta: true }] },
                { id: "eva_t2_p12", tema: 2, origen: "eva test", texto: "Cuando el fiador se coloca en la misma posición que el deudor principal, renunciando así a una serie de derechos que le concede la ley, pudiendo el acreedor (la entidad) dirigirse por vía judicial contra el obligado principal, contra el fiador o contra ambos a la vez por la totalidad de las obligaciones pendientes de pago, ¿se trata de un afianzamiento…?", opciones: [{ texto: "De segundo orden", esCorrecta: false }, { texto: "Subsidiario", esCorrecta: false }, { texto: "Declarativo", esCorrecta: false }, { texto: "Solidario", esCorrecta: true }] },

                // From Test Alberto.docx
                { id: "alb_t2_p3", tema: 2, origen: "Test Alberto", texto: "En una Sociedad Civil Particular:", opciones: [{ texto: "La responsabilidad de sus socios en mancomunada.", esCorrecta: true }, { texto: "Carece de beneficios.", esCorrecta: false }, { texto: "Está regulada por la Ley de Sociedades Anónimas.", esCorrecta: false }, { texto: "El contrato de constitución, no requiere en ningún caso su formalizarlo en escritura pública.", esCorrecta: false }] },
                { id: "alb_t2_p11", tema: 2, origen: "Test Alberto", texto: "El régimen matrimonial de sociedad de gananciales:", opciones: [{ texto: "Está en desuso desde mediados del siglo XX.", esCorrecta: false }, { texto: "Es el de aplicación en la mayor parte del territorio español.", esCorrecta: true }, { texto: "Permite a cualquiera de los cónyuges hipotecar un inmueble de la sociedad conyugal, sin necesidad del consentimiento del otro.", esCorrecta: false }, { texto: "Determina que, aunque la vivienda habitual forme parte de la sociedad conyugal, su venta se pueda realizar a título individual.", esCorrecta: false }] },

                // Generated for Tema 2
                { id: "gen_t2_p1", tema: 2, origen: "Generada", texto: "¿Qué información clave proporciona la CIRBE (Central de Información de Riesgos del Banco de España) a una entidad financiera sobre un particular?", opciones: [{ texto: "Su historial de ingresos detallado.", esCorrecta: false }, { texto: "El detalle de sus inversiones en bolsa.", esCorrecta: false }, { texto: "Los préstamos, créditos y avales que tiene concedidos por otras entidades financieras en España por encima de un umbral determinado.", esCorrecta: true }, { texto: "Su historial laboral completo.", esCorrecta: false }] },
                { id: "gen_t2_p2", tema: 2, origen: "Generada", texto: "Al analizar la capacidad de pago de un particular para un préstamo personal, ¿cuál es un indicador comúnmente utilizado?", opciones: [{ texto: "El valor de su vehículo.", esCorrecta: false }, { texto: "El número de seguidores en redes sociales.", esCorrecta: false }, { texto: "La ratio de endeudamiento (porcentaje de sus ingresos netos mensuales destinado al pago de deudas).", esCorrecta: true }, { texto: "La marca de su teléfono móvil.", esCorrecta: false }] },
                { id: "gen_t2_p3", tema: 2, origen: "Generada", texto: "Un 'préstamo preconcedido' a un particular se basa generalmente en:", opciones: [{ texto: "Una solicitud formal detallada del cliente.", esCorrecta: false }, { texto: "Un análisis exhaustivo de nuevas garantías aportadas.", esCorrecta: false }, { texto: "El historial de comportamiento y vinculación del cliente con la entidad, analizado mediante scoring.", esCorrecta: true }, { texto: "La recomendación de un amigo del cliente.", esCorrecta: false }] },
                { id: "gen_t2_p4", tema: 2, origen: "Generada", texto: "¿Cuál es el propósito principal de solicitar el informe de vida laboral a un particular que solicita financiación?", opciones: [{ texto: "Conocer sus aficiones.", esCorrecta: false }, { texto: "Verificar la estabilidad y continuidad de sus ingresos por trabajo.", esCorrecta: true }, { texto: "Determinar su nivel de estudios.", esCorrecta: false }, { texto: "Evaluar su estado civil.", esCorrecta: false }] },
                { id: "gen_t2_p5", tema: 2, origen: "Generada", texto: "En un afianzamiento 'subsidiario' o 'simple', el fiador:", opciones: [{ texto: "Responde en la misma posición que el deudor principal.", esCorrecta: false }, { texto: "Solo responde si el deudor principal es declarado insolvente y tras haberse intentado cobrar de este.", esCorrecta: true }, { texto: "No tiene ninguna responsabilidad real.", esCorrecta: false }, { texto: "Puede ser demandado directamente sin necesidad de reclamar primero al deudor principal.", esCorrecta: false }] },
                { id: "gen_t2_p6", tema: 2, origen: "Generada", texto: "¿Qué es el ASNEF o Equifax?", opciones: [{ texto: "Un registro de bienes inmuebles.", esCorrecta: false }, { texto: "Un fichero de solvencia patrimonial y crédito que recoge información sobre incumplimientos de obligaciones dinerarias.", esCorrecta: true }, { texto: "Una agencia de calificación de deuda soberana.", esCorrecta: false }, { texto: "El organismo supervisor del mercado de seguros.", esCorrecta: false }] },
                { id: "gen_t2_p7", tema: 2, origen: "Generada", texto: "La finalidad de un préstamo personal es importante porque:", opciones: [{ texto: "Permite al banco cobrar una comisión más alta.", esCorrecta: false }, { texto: "Ayuda a evaluar la coherencia de la solicitud y el riesgo asociado (p.ej. financiar un bien duradero vs. gastos corrientes).", esCorrecta: true }, { texto: "Es un requisito legal sin impacto en el riesgo.", esCorrecta: false }, { texto: "Solo es relevante si el importe es muy elevado.", esCorrecta: false }] },
                { id: "gen_t2_p8", tema: 2, origen: "Generada", texto: "Al evaluar un préstamo a un particular, ¿qué significa una 'ratio de cobertura de la deuda' (DCR) baja?", opciones: [{ texto: "Que el cliente tiene muchos ingresos para cubrir sus deudas.", esCorrecta: false }, { texto: "Que el cliente tiene un margen ajustado entre sus ingresos y sus obligaciones de deuda, indicando mayor riesgo.", esCorrecta: true }, { texto: "Que el préstamo está bien garantizado.", esCorrecta: false }, { texto: "Que el tipo de interés es muy bajo.", esCorrecta: false }] },
                { id: "gen_t2_p9", tema: 2, origen: "Generada", texto: "¿Qué tipo de garantía ofrece un depósito pignorado a favor de la entidad?", opciones: [{ texto: "Garantía personal.", esCorrecta: false }, { texto: "Garantía real mobiliaria.", esCorrecta: true }, { texto: "Garantía hipotecaria.", esCorrecta: false }, { texto: "Ninguna garantía, es solo un gesto de buena fe.", esCorrecta: false }] },
                { id: "gen_t2_p10", tema: 2, origen: "Generada", texto: "El 'beneficio de excusión' en un afianzamiento significa que:", opciones: [{ texto: "El fiador puede excusarse de pagar si no quiere.", esCorrecta: false }, { texto: "El acreedor debe primero intentar cobrar del patrimonio del deudor principal antes de poder reclamar al fiador (en fianzas simples).", esCorrecta: true }, { texto: "El deudor principal puede excusar al fiador de su obligación.", esCorrecta: false }, { texto: "El fiador está excluido de cualquier tipo de interés de demora.", esCorrecta: false }] },

                // --- TEMA 3: Análisis de Estados Financieros ---
                // From eva test.docx
                { id: "eva_t3_p1", tema: 3, origen: "eva test", texto: "Cuanto mayor sea la ratio de capacidad de devolución de los préstamos:", opciones: [{ texto: "La empresa tiene mayor capacidad de devolver los préstamos.", esCorrecta: true }, { texto: "La empresa tiene menor capacidad de generar ahorro.", esCorrecta: false }, { texto: "La empresa tiene menor capacidad de devolver los préstamos.", esCorrecta: false }, { texto: "La empresa posee insuficiente flujo de caja para la devolución de los préstamos.", esCorrecta: false }] },
                { id: "eva_t3_p6", tema: 3, origen: "eva test", texto: "Respecto a la amortización, señalar la respuesta correcta:", opciones: [{ texto: "Es el pago de las cuotas por la obtención de una maquinaria u otro activo.", esCorrecta: false }, { texto: "La amortización es un desembolso de efectivo que afecta directamente a la cuenta de tesorería.", esCorrecta: false }, { texto: "Es la cuantificación de la depreciación que sufren los bienes que componen el activo no corriente de una empresa.", esCorrecta: true }, { texto: "Es la cuantificación de los gastos realizados por el mantenimiento de los activos corrientes y no corrientes incluso.", esCorrecta: false }] },
                { id: "eva_t3_p13", tema: 3, origen: "eva test", texto: "El concepto de fondo de maniobra corresponde a:", opciones: [{ texto: "La diferencia entre activo no corriente y pasivo corriente.", esCorrecta: false }, { texto: "La diferencia entre activo corriente y pasivo corriente.", esCorrecta: true }, { texto: "Los activos de largo plazo financiados con pasivos a corto plazo.", esCorrecta: false }, { texto: "La suma de recursos permanentes y activo no corriente.", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t3_p2", tema: 3, origen: "Test Alberto", texto: "Un balance debe:", opciones: [{ texto: "Ser fiel a los intereses de los accionistas.", esCorrecta: false }, { texto: "Ser equilibrado.", esCorrecta: false }, { texto: "Reflejar la imagen fiel de la empresa.", esCorrecta: true }, { texto: "Reflejar la realidad de mercado.", esCorrecta: false }] },
                { id: "alb_t3_p8", tema: 3, origen: "Test Alberto", texto: "El apalancamiento financiero hace referencia a:", opciones: [{ texto: "La capacidad de aumentar la rentabilidad con los activos.", esCorrecta: false }, { texto: "La relación entre total de la deuda y recursos propios.", esCorrecta: false }, { texto: "La utilización de los recursos propios para incrementar los beneficios.", esCorrecta: false }, { texto: "La utilización de la deuda para incrementar la rentabilidad de los capitales propios.", esCorrecta: true }] },

                // Generated for Tema 3
                { id: "gen_t3_p1", tema: 3, origen: "Generada", texto: "El ROE (Return On Equity) se calcula como:", opciones: [{ texto: "Beneficio Neto / Activo Total.", esCorrecta: false }, { texto: "Beneficio Neto / Patrimonio Neto.", esCorrecta: true }, { texto: "Beneficio Bruto / Ventas.", esCorrecta: false }, { texto: "Activo Corriente / Pasivo Corriente.", esCorrecta: false }] },
                { id: "gen_t3_p2", tema: 3, origen: "Generada", texto: "Un fondo de maniobra negativo indica generalmente que:", opciones: [{ texto: "La empresa tiene un exceso de liquidez.", esCorrecta: false }, { texto: "La empresa financia parte de su activo no corriente con pasivo corriente, lo que puede generar tensiones de liquidez.", esCorrecta: true }, { texto: "La empresa es muy rentable.", esCorrecta: false }, { texto: "La empresa no tiene deudas a corto plazo.", esCorrecta: false }] },
                { id: "gen_t3_p3", tema: 3, origen: "Generada", texto: "¿Qué mide la ratio de liquidez general o 'current ratio'?", opciones: [{ texto: "La rentabilidad de los activos.", esCorrecta: false }, { texto: "La capacidad de la empresa para hacer frente a sus deudas a corto plazo con sus activos a corto plazo.", esCorrecta: true }, { texto: "El nivel de endeudamiento total de la empresa.", esCorrecta: false }, { texto: "La eficiencia en la gestión de inventarios.", esCorrecta: false }] },
                { id: "gen_t3_p4", tema: 3, origen: "Generada", texto: "El EBITDA corresponde a:", opciones: [{ texto: "Beneficio Neto más Impuestos.", esCorrecta: false }, { texto: "Beneficio Antes de Intereses, Impuestos, Depreciaciones y Amortizaciones.", esCorrecta: true }, { texto: "Ingresos totales menos costes variables.", esCorrecta: false }, { texto: "Flujo de caja de las actividades de financiación.", esCorrecta: false }] },
                { id: "gen_t3_p5", tema: 3, origen: "Generada", texto: "Si una empresa tiene una rotación de activos baja, podría indicar que:", opciones: [{ texto: "Está utilizando sus activos de manera muy eficiente para generar ventas.", esCorrecta: false }, { texto: "Podría tener un exceso de activos o no estar generando suficientes ventas en relación con su inversión en activos.", esCorrecta: true }, { texto: "Tiene un alto margen de beneficio.", esCorrecta: false }, { texto: "Su nivel de endeudamiento es bajo.", esCorrecta: false }] },
                { id: "gen_t3_p6", tema: 3, origen: "Generada", texto: "La diferencia entre el BAII (Beneficio Antes de Intereses e Impuestos) y el Beneficio Neto son principalmente:", opciones: [{ texto: "Las amortizaciones y depreciaciones.", esCorrecta: false }, { texto: "Los intereses financieros y los impuestos sobre beneficios.", esCorrecta: true }, { texto: "Los costes de ventas.", esCorrecta: false }, { texto: "Los ingresos extraordinarios.", esCorrecta: false }] },
                { id: "gen_t3_p7", tema: 3, origen: "Generada", texto: "¿Qué es el 'cash flow operativo'?", opciones: [{ texto: "El efectivo generado por la compra y venta de activos fijos.", esCorrecta: false }, { texto: "El efectivo generado por las actividades principales del negocio (cobros de clientes menos pagos a proveedores y gastos operativos).", esCorrecta: true }, { texto: "El efectivo obtenido de financiación externa (préstamos, emisión de acciones).", esCorrecta: false }, { texto: "El beneficio neto ajustado por partidas no monetarias como la amortización.", esCorrecta: false }] }, // Nota: Esta última podría ser una definición de FCF, la segunda es más directa para CFO
                { id: "gen_t3_p8", tema: 3, origen: "Generada", texto: "Una ratio de endeudamiento (Pasivo Total / Patrimonio Neto) muy alta sugiere:", opciones: [{ texto: "Una estructura financiera muy conservadora.", esCorrecta: false }, { texto: "Mayor riesgo financiero, ya que la empresa depende más de la financiación ajena y tiene menos colchón patrimonial.", esCorrecta: true }, { texto: "Alta rentabilidad asegurada.", esCorrecta: false }, { texto: "Poca necesidad de financiación externa.", esCorrecta: false }] },
                { id: "gen_t3_p9", tema: 3, origen: "Generada", texto: "El 'periodo medio de cobro' indica:", opciones: [{ texto: "Cuánto tiempo tarda la empresa en pagar a sus proveedores.", esCorrecta: false }, { texto: "Cuántos días, en promedio, tarda la empresa en cobrar sus ventas a crédito.", esCorrecta: true }, { texto: "La duración del ciclo de producción.", esCorrecta: false }, { texto: "El tiempo que las existencias permanecen en almacén.", esCorrecta: false }] },
                { id: "gen_t3_p10", tema: 3, origen: "Generada", texto: "En la cuenta de resultados, la amortización se considera:", opciones: [{ texto: "Un ingreso financiero.", esCorrecta: false }, { texto: "Un gasto que representa la pérdida de valor sistemática de los activos no corrientes.", esCorrecta: true }, { texto: "Una salida de efectivo directa.", esCorrecta: false }, { texto: "Un pasivo a largo plazo.", esCorrecta: false }] },

                // --- TEMA 4: Gestión del Riesgo de Crédito: Empresas, Seguimiento y Morosidad ---
                // From eva test.docx
                { id: "eva_t4_p3", tema: 4, origen: "eva test", texto: "Una operación al corriente de pago, que ha sido reestructurada durante el período de prueba, a partir de una operación anterior que ya había sido refinanciada, se clasifica como:", opciones: [{ texto: "Normal", esCorrecta: false }, { texto: "Normal en vigilancia especial", esCorrecta: false }, { texto: "Fallido", esCorrecta: false }, { texto: "Dudoso", esCorrecta: true }] },
                { id: "eva_t4_p12", tema: 4, origen: "eva test", texto: "De acuerdo a la normativa del BE ¿cómo se denomina la obligación de vincular todas las operaciones de un mismo moroso dentro de la clasificación de dudosos, aunque algunas de ellas estén al corriente de pago, cuando el total dudoso es superior al 20% del riesgo total del cliente?", opciones: [{ texto: "Vigilancia especial", esCorrecta: false }, { texto: "Dudosos por razones distintas a la morosidad", esCorrecta: false }, { texto: "Efecto arrastre", esCorrecta: true }, { texto: "Operaciones sin riesgo apreciable", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t4_p1", tema: 4, origen: "Test Alberto", texto: "Una empresa siderúrgica que genera altas emisiones de gases de efecto invernadero.", opciones: [{ texto: "Requieren un estudio más exhaustivo de su modelo de negocio y de los factores ASG.", esCorrecta: true }, { texto: "Debemos revisar que toda su financiación se realice con recursos permanentes (capital + deuda a largo plazo)", esCorrecta: false }, { texto: "Es un cliente atractivo para un project Finance.", esCorrecta: false }, { texto: "No deben ser financiadas a través de crédito bancario.", esCorrecta: false }] },
                { id: "alb_t4_p15", tema: 4, origen: "Test Alberto", texto: "En los concursos de acreedores las deudas anteriores a la fecha de declaración del concurso se denominan:", opciones: [{ texto: "Créditos ordinarios", esCorrecta: false }, { texto: "Créditos concursales", esCorrecta: true }, { texto: "Créditos privilegiados", esCorrecta: false }, { texto: "Créditos contra la masa", esCorrecta: false }] },

                // Generated for Tema 4
                { id: "gen_t4_p1", tema: 4, origen: "Generada", texto: "¿Qué significa que una operación de crédito empresarial entre en 'vigilancia especial'?", opciones: [{ texto: "Que la operación ha sido cancelada.", esCorrecta: false }, { texto: "Que, aunque esté al corriente de pago, existen indicios de un posible incremento del riesgo o debilidades financieras.", esCorrecta: true }, { texto: "Que la operación es altamente rentable para el banco.", esCorrecta: false }, { texto: "Que el cliente ha solicitado un aumento del límite.", esCorrecta: false }] },
                { id: "gen_t4_p2", tema: 4, origen: "Generada", texto: "En el contexto de 'Project Finance', ¿qué es una SPV (Special Purpose Vehicle)?", opciones: [{ texto: "Un tipo de garantía real.", esCorrecta: false }, { texto: "Una sociedad creada específicamente para desarrollar el proyecto, aislando financieramente el riesgo del mismo.", esCorrecta: true }, { texto: "Un organismo supervisor de proyectos de inversión.", esCorrecta: false }, { texto: "Un software de modelización financiera para proyectos.", esCorrecta: false }] },
                { id: "gen_t4_p3", tema: 4, origen: "Generada", texto: "La 'reestructuración' de una deuda implica:", opciones: [{ texto: "Siempre una quita del principal.", esCorrecta: false }, { texto: "La modificación de las condiciones financieras originales (plazo, tipo de interés, carencias) para facilitar el pago al deudor con dificultades.", esCorrecta: true }, { texto: "La cancelación de la deuda por parte del banco.", esCorrecta: false }, { texto: "La venta de la deuda a un tercero.", esCorrecta: false }] },
                { id: "gen_t4_p4", tema: 4, origen: "Generada", texto: "¿Cuál es el objetivo principal del seguimiento continuo del riesgo de crédito en empresas?", opciones: [{ texto: "Vender más productos al cliente.", esCorrecta: false }, { texto: "Detectar tempranamente cualquier deterioro en la capacidad de pago del acreditado y tomar medidas preventivas o correctoras.", esCorrecta: true }, { texto: "Cumplir con un trámite burocrático.", esCorrecta: false }, { texto: "Aumentar el tipo de interés de las operaciones vigentes.", esCorrecta: false }] },
                { id: "gen_t4_p5", tema: 4, origen: "Generada", texto: "Una 'provisión específica' para una operación de crédito se dota cuando:", opciones: [{ texto: "La operación es nueva y tiene un riesgo estándar.", esCorrecta: false }, { texto: "Existen evidencias claras de que la operación ha incurrido en mora y se espera una pérdida concreta.", esCorrecta: true }, { texto: "La entidad quiere aumentar su colchón de capital general.", esCorrecta: false }, { texto: "El cliente solicita una carencia en el pago.", esCorrecta: false }] },
                { id: "gen_t4_p6", tema: 4, origen: "Generada", texto: "¿Qué es el 'riesgo país' en el contexto de financiación a empresas?", opciones: [{ texto: "El riesgo de que la empresa cambie de país.", esCorrecta: false }, { texto: "Los riesgos asociados a la operativa en un determinado país, como inestabilidad política, riesgo de transferencia, o expropiación.", esCorrecta: true }, { texto: "El riesgo de que el país de origen de la empresa entre en recesión.", esCorrecta: false }, { texto: "El riesgo de que los productos de la empresa no se vendan en ese país.", esCorrecta: false }] },
                { id: "gen_t4_p7", tema: 4, origen: "Generada", texto: "El análisis de sensibilidad en la evaluación crediticia de una empresa ayuda a:", opciones: [{ texto: "Determinar el valor exacto de sus acciones.", esCorrecta: false }, { texto: "Evaluar cómo cambios en variables clave (ventas, costes, tipos de interés) afectarían su capacidad de pago.", esCorrecta: true }, { texto: "Fijar el tipo de interés del préstamo.", esCorrecta: false }, { texto: "Calcular las provisiones genéricas.", esCorrecta: false }] },
                { id: "gen_t4_p8", tema: 4, origen: "Generada", texto: "¿Qué se entiende por 'crédito fallido' (write-off)?", opciones: [{ texto: "Un crédito que se ha pagado en su totalidad antes de tiempo.", esCorrecta: false }, { texto: "Un crédito que la entidad considera irrecuperable y da de baja contablemente de su activo, aunque pueda seguir intentando su cobro.", esCorrecta: true }, { texto: "Un crédito que ha fallado en generar los beneficios esperados.", esCorrecta: false }, { texto: "Un crédito en situación de vigilancia especial.", esCorrecta: false }] },
                { id: "gen_t4_p9", tema: 4, origen: "Generada", texto: "El 'completion test' en un Project Finance es crucial porque:", opciones: [{ texto: "Marca el inicio de la construcción del proyecto.", esCorrecta: false }, { texto: "Verifica que el proyecto ha sido construido según especificaciones y es capaz de operar y generar los flujos de caja previstos.", esCorrecta: true }, { texto: "Es el momento en que se desembolsa toda la financiación.", esCorrecta: false }, { texto: "Determina la empresa que suministrará la materia prima.", esCorrecta: false }] },
                { id: "gen_t4_p10", tema: 4, origen: "Generada", texto: "Una 'refinanciación' de deuda, sin que el prestatario muestre dificultades financieras, implica:", opciones: [{ texto: "Siempre una extensión del plazo y una reducción del tipo de interés.", esCorrecta: false }, { texto: "La sustitución de una operación existente por una nueva, generalmente para mejorar condiciones o consolidar deudas, sin que exista un deterioro crediticio subyacente.", esCorrecta: true }, { texto: "La entrada en concurso de acreedores.", esCorrecta: false }, { texto: "La dación en pago de activos.", esCorrecta: false }] },


                // --- TEMA 5: Riesgos de Productos de Activo ---
                // From eva test.docx
                { id: "eva_t5_p1", tema: 5, origen: "eva test", texto: "El ‘confirming’ no suele ser el producto más apropiado para:", opciones: [{ texto: "Grandes empresas.", esCorrecta: false }, { texto: "Grandes empresas en relación con la gestión y la eventual financiación del pago a sus proveedores.", esCorrecta: false }, { texto: "Grandes empresas que cuentan con un gran número de pequeños proveedores.", esCorrecta: false }, { texto: "Microempresas, pequeñas empresas y autónomos.", esCorrecta: true }] },
                { id: "eva_t5_p6", tema: 5, origen: "eva test", texto: "En el marco de un contrato de ‘factoring’ sin recurso:", opciones: [{ texto: "Es el cliente quien asume la contingencia en el caso de que un deudor no pague una factura, sea cual sea la causa del impago.", esCorrecta: false }, { texto: "Es la entidad financiera quien asume la contingencia en caso de que un deudor no pague una factura.", esCorrecta: false }, { texto: "No obstante, no se admite cualquier causa de impago en este sentido.", esCorrecta: false }, { texto: "Es la entidad financiera quien asume la contingencia en caso de que un deudor no pague una factura, sea cual sea la causa del impago.", esCorrecta: true }] },

                // From Test Alberto.docx
                { id: "alb_t5_p2", tema: 5, origen: "Test Alberto", texto: "El aval idóneo para garantizar los pagos de cliente a proveedor relativos a una relación comercial es:", opciones: [{ texto: "El aval comercial-financiero.", esCorrecta: true }, { texto: "El aval económico-financiero.", esCorrecta: false }, { texto: "El aval económico-comercial.", esCorrecta: false }, { texto: "El aval técnico.", esCorrecta: false }] },
                { id: "alb_t5_p4", tema: 5, origen: "Test Alberto", texto: "Una operación de arrendamiento financiero:", opciones: [{ texto: "Generalmente termina con la adquisición del bien por parte del cliente, a cambio de una última cuota o ‘valor residual’.", esCorrecta: true }, { texto: "Generalmente termina con la adquisición del bien por parte de la entidad de crédito, entregando al cliente el importe equivalente al valor residual del activo.", esCorrecta: false }, { texto: "Es una operación sin riesgo para la entidad de crédito, al contar con la propiedad del bien objeto del contrato.", esCorrecta: false }, { texto: "No figura en la Central de Información de Riesgos del Banco de España.", esCorrecta: false }] },

                // Generated for Tema 5
                { id: "gen_t5_p1", tema: 5, origen: "Generada", texto: "¿Cuál es la principal diferencia entre un 'factoring con recurso' y un 'factoring sin recurso'?", opciones: [{ texto: "El plazo de financiación de las facturas.", esCorrecta: false }, { texto: "En el 'sin recurso', la entidad financiera asume el riesgo de insolvencia del deudor cedido; en el 'con recurso', el cliente (cedente) retiene ese riesgo.", esCorrecta: true }, { texto: "El tipo de facturas que se pueden ceder.", esCorrecta: false }, { texto: "El 'sin recurso' no permite anticipo de fondos.", esCorrecta: false }] },
                { id: "gen_t5_p2", tema: 5, origen: "Generada", texto: "En un contrato de 'leasing' financiero (arrendamiento financiero), la propiedad legal del bien durante la vida del contrato generalmente reside en:", opciones: [{ texto: "El arrendatario.", esCorrecta: false }, { texto: "La entidad de leasing (arrendador).", esCorrecta: true }, { texto: "Un tercero independiente.", esCorrecta: false }, { texto: "El proveedor del bien.", esCorrecta: false }] },
                { id: "gen_t5_p3", tema: 5, origen: "Generada", texto: "El 'descuento comercial' de efectos (letras de cambio, pagarés) implica que la entidad financiera:", opciones: [{ texto: "Compra los efectos sin recurso alguno contra el cliente.", esCorrecta: false }, { texto: "Anticipa el importe de los efectos al cliente, deduciendo intereses y comisiones, y generalmente con recurso en caso de impago por el librado.", esCorrecta: true }, { texto: "Solo gestiona el cobro de los efectos al vencimiento.", esCorrecta: false }, { texto: "Emite los efectos en nombre del cliente.", esCorrecta: false }] },
                { id: "gen_t5_p4", tema: 5, origen: "Generada", texto: "¿Qué riesgo principal mitiga un 'crédito documentario' para el exportador?", opciones: [{ texto: "El riesgo de fluctuación del tipo de cambio.", esCorrecta: false }, { texto: "El riesgo de impago por parte del importador, siempre que el exportador cumpla con los términos y condiciones del crédito.", esCorrecta: true }, { texto: "El riesgo de transporte de la mercancía.", esCorrecta: false }, { texto: "El riesgo de que el importador no necesite la mercancía.", esCorrecta: false }] },
                { id: "gen_t5_p5", tema: 5, origen: "Generada", texto: "Una 'línea de crédito revolving' se caracteriza por:", opciones: [{ texto: "Ser un préstamo a plazo fijo con cuotas constantes.", esCorrecta: false }, { texto: "Permitir al cliente disponer de fondos hasta un límite aprobado, pudiendo reutilizar el principal devuelto.", esCorrecta: true }, { texto: "Estar destinada exclusivamente a la financiación de importaciones.", esCorrecta: false }, { texto: "No generar intereses.", esCorrecta: false }] },
                { id: "gen_t5_p6", tema: 5, origen: "Generada", texto: "¿Qué es un aval 'a primer requerimiento'?", opciones: [{ texto: "Un aval que solo se puede ejecutar después de un largo proceso judicial.", esCorrecta: false }, { texto: "Un aval que obliga al beneficiario a demostrar fehacientemente el incumplimiento del avalado antes de reclamar.", esCorrecta: false }, { texto: "Un aval por el cual el banco (avalista) se obliga a pagar al beneficiario tan pronto como este lo reclame, sin necesidad de que el beneficiario pruebe el incumplimiento del deudor principal.", esCorrecta: true }, { texto: "Un aval que solo cubre el primer impago.", esCorrecta: false }] },
                { id: "gen_t5_p7", tema: 5, origen: "Generada", texto: "El riesgo de 'papel de colusión' en el descuento comercial se refiere a:", opciones: [{ texto: "El riesgo de que el papel del efecto se deteriore.", esCorrecta: false }, { texto: "El riesgo de que cedente y librado se pongan de acuerdo para descontar efectos que no corresponden a operaciones comerciales reales.", esCorrecta: true }, { texto: "El riesgo de que el librado sea una empresa extranjera.", esCorrecta: false }, { texto: "El riesgo de que las firmas del efecto sean falsas.", esCorrecta: false }] },
                { id: "gen_t5_p8", tema: 5, origen: "Generada", texto: "¿Cuál es la función principal de un TPV (Terminal Punto de Venta) para un comercio?", opciones: [{ texto: "Gestionar el inventario del comercio.", esCorrecta: false }, { texto: "Procesar pagos electrónicos con tarjetas de crédito/débito.", esCorrecta: true }, { texto: "Emitir facturas electrónicas a los clientes.", esCorrecta: false }, { texto: "Ofrecer financiación a los clientes del comercio.", esCorrecta: false }] },
                { id: "gen_t5_p9", tema: 5, origen: "Generada", texto: "En el 'renting' (arrendamiento operativo), a diferencia del 'leasing' financiero, generalmente:", opciones: [{ texto: "La opción de compra al final del contrato es obligatoria.", esCorrecta: false }, { texto: "Se incluyen servicios adicionales como mantenimiento, seguro, etc., y no suele existir opción de compra o es por valor de mercado.", esCorrecta: true }, { texto: "El plazo mínimo legal es de 10 años.", esCorrecta: false }, { texto: "El arrendatario asume todos los riesgos y beneficios de la propiedad desde el inicio.", esCorrecta: false }] },
                { id: "gen_t5_p10", tema: 5, origen: "Generada", texto: "Un 'préstamo sindicado' es una operación donde:", opciones: [{ texto: "Un solo banco presta a un sindicato de empresas.", esCorrecta: false }, { texto: "Varios bancos se unen para conceder una financiación de gran volumen a un único prestatario, compartiendo el riesgo.", esCorrecta: true }, { texto: "El sindicato de trabajadores de una empresa obtiene un préstamo.", esCorrecta: false }, { texto: "La financiación está destinada a actividades sindicales.", esCorrecta: false }] },

                // --- TEMA 6: Concesión de Operaciones a Personas Físicas: Consumo/Hipotecario ---
                // From eva test.docx
                { id: "eva_t6_p1", tema: 6, origen: "eva test", texto: "Un cliente nos ha propuesto el estudio de la financiación para la adquisición de un inmueble del que nos aportaría la garantía hipotecaria. Solicitada la verificación registral, constatamos la existencia de un censo en la finca aportada en garantía, lo que supone:", opciones: [{ texto: "Dependiendo de la edad del titular del derecho, puede que se tenga que levantar o puede que no.", esCorrecta: false }, { texto: "En realidad nada, pues es una carga de poco uso en el mercado.", esCorrecta: false }, { texto: "La necesidad de levantar la carga previamente a la constitución de la nueva operación hipotecaria.", esCorrecta: true }, { texto: "La necesidad de comunicárselo a la oficina del censo para que tome nota de la modificación de la titularidad registral.", esCorrecta: false }] },
                { id: "eva_t6_p4", tema: 6, origen: "eva test", texto: "En el caso de que un menor de 18 años no emancipado solicite una operación de préstamo personal:", opciones: [{ texto: "Solo se pueden autorizar préstamos personales a mayores de 18 años.", esCorrecta: false }, { texto: "Sólo pueden firmar la operación menores de edad si no están emancipados.", esCorrecta: false }, { texto: "Se pueden autorizar préstamos a menores de edad si existe el consentimiento de sus padres o tutores.", esCorrecta: true }, { texto: "Para su formalización es necesaria la autorización previa del Comité de Créditos.", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t6_p1", tema: 6, origen: "Test Alberto", texto: "Ante una solicitud de crédito de una Unión Temporal de Empresas (UTE), sabemos que:", opciones: [{ texto: "Siempre se mantiene la responsabilidad ante terceros de manera mancomunada en función a su participación e ilimitada entre sus miembros, al tener personalidad jurídica propia.", esCorrecta: false }, { texto: "Siempre se mantiene la responsabilidad ante terceros de manera solidaria e ilimitada entre sus miembros, al no tener personalidad jurídica propia.", esCorrecta: true }, { texto: "Siempre se mantiene la responsabilidad ante terceros de manera solidaria pero limitada entre sus miembros, al no tener personalidad jurídica propia.", esCorrecta: false }, { texto: "Siempre se puede inscribir con doble personalidad, jurídica o no, y su responsabilidad también es doble, mancomunada o solidaria.", esCorrecta: false }] },
                { id: "alb_t6_p11", tema: 6, origen: "Test Alberto", texto: "¿De qué forma suelen comprobar las entidades financieras que la obra en curso de una autopromoción se está llevando a cabo?", opciones: [{ texto: "A través de los informes de los empleados jubilados de banca.", esCorrecta: false }, { texto: "A través de las asociaciones hipotecarias, mediante la emisión de certificados.", esCorrecta: false }, { texto: "A través de los informes de los concejales de obras públicas municipales.", esCorrecta: false }, { texto: "A través de sociedades de tasación, mediante actualizaciones de obras.", esCorrecta: true }] },

                // Generated for Tema 6
                { id: "gen_t6_p1", tema: 6, origen: "Generada", texto: "¿Qué es la FEIN (Ficha Europea de Información Normalizada) en un préstamo hipotecario?", opciones: [{ texto: "Un documento que se entrega después de la firma del préstamo.", esCorrecta: false }, { texto: "Un documento precontractual estandarizado que contiene la información esencial del préstamo hipotecario ofrecido al consumidor.", esCorrecta: true }, { texto: "El contrato de seguro de vida asociado a la hipoteca.", esCorrecta: false }, { texto: "La tasación oficial del inmueble.", esCorrecta: false }] },
                { id: "gen_t6_p2", tema: 6, origen: "Generada", texto: "El 'Loan To Value' (LTV) en una hipoteca representa:", opciones: [{ texto: "El plazo total del préstamo en años.", esCorrecta: false }, { texto: "La relación porcentual entre el importe del préstamo concedido y el valor de tasación (o compraventa, el menor) del inmueble.", esCorrecta: true }, { texto: "El tipo de interés aplicado a la operación.", esCorrecta: false }, { texto: "La capacidad de endeudamiento del solicitante.", esCorrecta: false }] },
                { id: "gen_t6_p3", tema: 6, origen: "Generada", texto: "¿Por qué es importante la tasación de un inmueble en una operación hipotecaria?", opciones: [{ texto: "Para determinar el IBI que pagará el propietario.", esCorrecta: false }, { texto: "Sirve de base para que la entidad financiera determine el importe máximo del préstamo y para la valoración de la garantía en caso de ejecución.", esCorrecta: true }, { texto: "Para fijar el precio de venta del inmueble en el mercado.", esCorrecta: false }, { texto: "Es un requisito solo para viviendas de nueva construcción.", esCorrecta: false }] },
                { id: "gen_t6_p4", tema: 6, origen: "Generada", texto: "En un préstamo hipotecario, ¿qué significa 'subrogación del deudor'?", opciones: [{ texto: "Que el banco cambia las condiciones del préstamo unilateralmente.", esCorrecta: false }, { texto: "Que un nuevo deudor (p.ej., el comprador de la vivienda) asume la posición del deudor original en el préstamo existente, con el consentimiento del banco.", esCorrecta: true }, { texto: "La cancelación anticipada total del préstamo.", esCorrecta: false }, { texto: "El cambio de la vivienda hipotecada por otra.", esCorrecta: false }] },
                { id: "gen_t6_p5", tema: 6, origen: "Generada", texto: "La Ley de Crédito al Consumo se aplica a préstamos personales concedidos a personas físicas para finalidades como:", opciones: [{ texto: "La compra de acciones en bolsa.", esCorrecta: false }, { texto: "La adquisición de bienes de consumo (electrodomésticos, vehículos), viajes, o refinanciación de pequeñas deudas, entre otros.", esCorrecta: true }, { texto: "La financiación de actividades empresariales.", esCorrecta: false }, { texto: "Préstamos hipotecarios para la compra de vivienda habitual.", esCorrecta: false }] },
                { id: "gen_t6_p6", tema: 6, origen: "Generada", texto: "¿Qué es una 'hipoteca inversa'?", opciones: [{ texto: "Un préstamo donde el banco paga al cliente por vivir en su casa.", esCorrecta: false }, { texto: "Un producto financiero destinado a personas mayores de una cierta edad, propietarias de una vivienda, que les permite obtener una renta periódica o un capital único a cambio de la disposición futura de su vivienda, sin perder la propiedad en vida.", esCorrecta: true }, { texto: "Una hipoteca donde las cuotas son decrecientes.", esCorrecta: false }, { texto: "Una hipoteca que se puede cancelar en cualquier momento sin coste.", esCorrecta: false }] },
                { id: "gen_t6_p7", tema: 6, origen: "Generada", texto: "Al analizar una solicitud de préstamo al consumo, un 'scoring' negativo generalmente indica:", opciones: [{ texto: "Aprobación automática del préstamo.", esCorrecta: false }, { texto: "Una alta probabilidad de incumplimiento según el modelo de la entidad, lo que podría llevar a la denegación o a solicitar mayores garantías.", esCorrecta: true }, { texto: "Que el cliente es nuevo en la entidad.", esCorrecta: false }, { texto: "Que el importe solicitado es muy bajo.", esCorrecta: false }] },
                { id: "gen_t6_p8", tema: 6, origen: "Generada", texto: "El 'plazo de amortización' de un préstamo hipotecario es:", opciones: [{ texto: "El tiempo durante el cual se pueden hacer disposiciones del capital.", esCorrecta: false }, { texto: "El período total durante el cual el prestatario debe devolver el capital prestado más los intereses.", esCorrecta: true }, { texto: "El período de carencia inicial.", esCorrecta: false }, { texto: "El tiempo que tarda el banco en aprobar el préstamo.", esCorrecta: false }] },
                { id: "gen_t6_p9", tema: 6, origen: "Generada", texto: "¿Es obligatorio contratar un seguro de vida al formalizar un préstamo hipotecario?", opciones: [{ texto: "Sí, siempre es exigido por ley.", esCorrecta: false }, { texto: "No es legalmente obligatorio, pero las entidades suelen ofrecerlo (y a veces bonificar condiciones por su contratación) como una forma de cubrir el riesgo de fallecimiento o invalidez del deudor.", esCorrecta: true }, { texto: "Solo es obligatorio para hipotecas de segunda vivienda.", esCorrecta: false }, { texto: "Sí, y debe ser con la aseguradora del propio banco.", esCorrecta: false }] },
                { id: "gen_t6_p10", tema: 6, origen: "Generada", texto: "Una 'nota simple' del Registro de la Propiedad informa sobre:", opciones: [{ texto: "El valor de tasación de la finca.", esCorrecta: false }, { texto: "La titularidad de la finca, su descripción, y las cargas o gravámenes que pueda tener (hipotecas, embargos, servidumbres).", esCorrecta: true }, { texto: "El estado de conservación del inmueble.", esCorrecta: false }, { texto: "Los impuestos pendientes de pago sobre la finca.", esCorrecta: false }] },

                // --- TEMA 7: Concesión de Operaciones a Personas Físicas: Negocios ---
                // From eva test.docx
                { id: "eva_t7_p1", tema: 7, origen: "eva test", texto: "Las personas físicas con actividad empresarial deben presentar la declaración del impuesto del valor añadido con periodicidad:", opciones: [{ texto: "Trimestral.", esCorrecta: true }, { texto: "Anual.", esCorrecta: false }, { texto: "Trimestral, excepto el régimen de estimación objetiva, que se debe presentar anualmente.", esCorrecta: false }, { texto: "Mensual.", esCorrecta: false }] },
                { id: "eva_t7_p9", tema: 7, origen: "eva test", texto: "La edad del propietario es un aspecto cualitativo que considerar en la evaluación de los riesgos de una persona física con actividad empresarial, debido a:", opciones: [{ texto: "La importancia de evaluar la posibilidad del relevo generacional del negocio.", esCorrecta: true }, { texto: "El aumento impositivo en negocios llevados a cabo por personal de avanzada edad.", esCorrecta: false }, { texto: "El relevo generacional no es un factor que se analice por riesgos.", esCorrecta: false }, { texto: "La falta de innovación comercial y financiera, cuando el propietario es de avanzada edad.", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t7_p1", tema: 7, origen: "Test Alberto", texto: "Los plazos de devolución en el sistema B2B son inferiores que en el sistema CORE:", opciones: [{ texto: "Falso. En realidad son superiores.", esCorrecta: false }, { texto: "Falso. En el sistema B2B no se contempla la devolución de los recibos.", esCorrecta: false }, { texto: "Verdadero. Los plazos son inferiores.", esCorrecta: true }, { texto: "Falso. En realidad son iguales.", esCorrecta: false }] }, // Nota: La respuesta correcta en el test de Alberto es "Verdadero. Los plazos son inferiores." que corresponde a la opción de plazos más cortos para B2B.
                { id: "alb_t7_p12", tema: 7, origen: "Test Alberto", texto: "¿Podemos plantear operaciones de arrendamiento financiero de bienes muebles a un plazo inferior a 2 años?", opciones: [{ texto: "No, la norma solo lo contempla para el caso de bienes inmuebles.", esCorrecta: false }, { texto: "Sí, si se trata de un muy buen cliente.", esCorrecta: false }, { texto: "No, la norma determina un plazo mínimo de 4 años para los bienes muebles.", esCorrecta: false }, { texto: "No, la norma determina un plazo mínimo de 2 años para los bienes muebles.", esCorrecta: true }] },

                // Generated for Tema 7
                { id: "gen_t7_p1", tema: 7, origen: "Generada", texto: "¿Cuál es una dificultad común al analizar las finanzas de un autónomo o profesional liberal?", opciones: [{ texto: "La excesiva regulación de sus estados financieros.", esCorrecta: false }, { texto: "La clara separación entre patrimonio personal y empresarial.", esCorrecta: false }, { texto: "La mezcla frecuente entre finanzas personales y del negocio, y la variabilidad de ingresos.", esCorrecta: true }, { texto: "La obligación de presentar auditorías anuales exhaustivas.", esCorrecta: false }] },
                { id: "gen_t7_p2", tema: 7, origen: "Generada", texto: "Al financiar la adquisición de un local comercial para un negocio (persona física), ¿qué se suele analizar además de la capacidad de pago del individuo?", opciones: [{ texto: "El color de la fachada del local.", esCorrecta: false }, { texto: "La viabilidad y proyecciones del negocio que se desarrollará en el local, y el valor del propio local como garantía.", esCorrecta: true }, { texto: "Las aficiones del propietario.", esCorrecta: false }, { texto: "Únicamente el historial crediticio personal.", esCorrecta: false }] },
                { id: "gen_t7_p3", tema: 7, origen: "Generada", texto: "El régimen de estimación objetiva (módulos) para autónomos implica que el rendimiento neto se calcula:", opciones: [{ texto: "En base a facturas reales de ingresos y gastos.", esCorrecta: false }, { texto: "Aplicando unos índices o módulos preestablecidos por la Administración Tributaria a ciertos parámetros del negocio (personal, superficie, etc.).", esCorrecta: true }, { texto: "Como un porcentaje fijo sobre los beneficios del año anterior.", esCorrecta: false }, { texto: "De la misma forma que el Impuesto de Sociedades.", esCorrecta: false }] },
                { id: "gen_t7_p4", tema: 7, origen: "Generada", texto: "¿Qué tipo de financiación es más adecuada para cubrir necesidades de circulante de un negocio (p.ej., pago a proveedores, gestión de stocks)?", opciones: [{ texto: "Un préstamo hipotecario a 20 años.", esCorrecta: false }, { texto: "Una línea de crédito o un descuento comercial.", esCorrecta: true }, { texto: "La emisión de obligaciones corporativas.", esCorrecta: false }, { texto: "Un leasing inmobiliario.", esCorrecta: false }] },
                { id: "gen_t7_p5", tema: 7, origen: "Generada", texto: "La 'asistencia financiera' prohibida por ley se refiere a situaciones donde:", opciones: [{ texto: "Un banco ayuda financieramente a un cliente en dificultades.", esCorrecta: false }, { texto: "Una sociedad presta dinero o concede garantías para que un tercero adquiera acciones de la propia sociedad o de su dominante.", esCorrecta: true }, { texto: "El Estado asiste financieramente a sectores en crisis.", esCorrecta: false }, { texto: "Los socios se asisten financieramente entre ellos.", esCorrecta: false }] },
                { id: "gen_t7_p6", tema: 7, origen: "Generada", texto: "En el análisis de riesgo de un TPV para un comercio, ¿qué podría indicar un mayor riesgo de fraude?", opciones: [{ texto: "Un ticket medio de venta muy bajo y estable.", esCorrecta: false }, { texto: "Un aumento repentino y muy significativo de la facturación, especialmente con tarjetas extranjeras o en operaciones no presenciales.", esCorrecta: true }, { texto: "Que el comercio opere exclusivamente en canal presencial con lectura de chip.", esCorrecta: false }, { texto: "Un bajo porcentaje de devoluciones.", esCorrecta: false }] },
                { id: "gen_t7_p7", tema: 7, origen: "Generada", texto: "Un 'fondo de comercio' como activo intangible representa:", opciones: [{ texto: "El valor de las existencias en el comercio.", esCorrecta: false }, { texto: "El valor adicional de un negocio por encima de sus activos netos identificables, debido a factores como clientela, reputación, marca, etc.", esCorrecta: true }, { texto: "El capital aportado por los socios del comercio.", esCorrecta: false }, { texto: "El local físico donde se ubica el comercio.", esCorrecta: false }] },
                { id: "gen_t7_p8", tema: 7, origen: "Generada", texto: "La 'capacidad gerencial' del propietario de un negocio se refiere a:", opciones: [{ texto: "Su capacidad para levantar objetos pesados.", esCorrecta: false }, { texto: "Sus habilidades y experiencia en la gestión del negocio, toma de decisiones, planificación y adaptación al mercado.", esCorrecta: true }, { texto: "Su nivel de estudios universitarios únicamente.", esCorrecta: false }, { texto: "El número de empleados que tiene a su cargo.", esCorrecta: false }] },
                { id: "gen_t7_p9", tema: 7, origen: "Generada", texto: "¿Qué es un 'leasing operativo' (renting)?", opciones: [{ texto: "Un contrato de alquiler a corto plazo con opción de compra obligatoria.", esCorrecta: false }, { texto: "Un contrato de arrendamiento de un bien (generalmente mueble) donde la cuota incluye el uso y, a menudo, servicios adicionales (mantenimiento, seguro), y no suele tener como objetivo principal la adquisición final del bien.", esCorrecta: true }, { texto: "Una forma de financiar la compra de inmuebles para operar un negocio.", esCorrecta: false }, { texto: "Un préstamo para cubrir gastos operativos.", esCorrecta: false }] },
                { id: "gen_t7_p10", tema: 7, origen: "Generada", texto: "Al evaluar un negocio 'regulado' (ej. farmacia, estanco), un factor de riesgo adicional es:", opciones: [{ texto: "La alta competencia del sector.", esCorrecta: false }, { texto: "La dependencia de cambios en la regulación administrativa (precios, licencias, normativas) que pueden afectar la rentabilidad o viabilidad.", esCorrecta: true }, { texto: "La necesidad de mucha innovación tecnológica.", esCorrecta: false }, { texto: "La facilidad para obtener financiación pública.", esCorrecta: false }] },

                // --- TEMA 8: Concesión de Operaciones a Personas Jurídicas: Microempresas ---
                // From eva test.docx
                { id: "eva_t8_p1", tema: 8, origen: "eva test", texto: "Podemos decir que la duración del Presupuesto Municipal, siempre:", opciones: [{ texto: "Coincide con el período electoral.", esCorrecta: false }, { texto: "Coincide con el año natural.", esCorrecta: true }, { texto: "Viene determinada por la fecha de aprobación y dura 12 meses desde que esta se produce.", esCorrecta: false }, { texto: "Coincide desde su aprobación por el pleno y hasta su vencimiento.", esCorrecta: false }] },
                { id: "eva_t8_p10", tema: 8, origen: "eva test", texto: "Dado que los microcréditos gozan de cierta cobertura de insolvencias por parte del Fondo Europeo de Inversiones (FEI), entonces deberemos estudiarlos:", opciones: [{ texto: "Siguiendo las políticas que para este tipo de productos determina el FEI, ya que avala la operación.", esCorrecta: false }, { texto: "Como si de una operación con pignoración se tratase.", esCorrecta: false }, { texto: "Como si se tratase de operaciones de crédito con garantía real, alargando su plazo.", esCorrecta: false }, { texto: "Siguiendo las mismas políticas de concesión de riesgos que rige en la entidad financiera.", esCorrecta: true }] },

                // From Test Alberto.docx
                { id: "alb_t8_p1", tema: 8, origen: "Test Alberto", texto: "El primer banco creado con la filosofía de conceder pequeños préstamos se fundó con el objetivo de:", opciones: [{ texto: "Impulsar proyectos de formación financiera de pequeño importe.", esCorrecta: false }, { texto: "Buscar un nicho del mercado de crédito, donde no estaban las entidades financieras.", esCorrecta: false }, { texto: "Impulsar proyectos de marketing financiero al colectivo de mujeres.", esCorrecta: false }, { texto: "Impulsar proyectos laborales de pequeño importe que ayudasen a la inclusión crediticia de personas sin historial crediticio.", esCorrecta: true }] },
                { id: "alb_t8_p4", tema: 8, origen: "Test Alberto", texto: "Entendemos por Fondo de Maniobra la diferencia entre:", opciones: [{ texto: "El Activo Corriente y el Pasivo Corriente", esCorrecta: true }, { texto: "El Activo no Corriente y el Pasivo Corriente.", esCorrecta: false }, { texto: "El Activo Corriente y el Pasivo no Corriente", esCorrecta: false }, { texto: "El Activo no Corriente y los Fondos Propios", esCorrecta: false }] },

                // Generated for Tema 8
                { id: "gen_t8_p1", tema: 8, origen: "Generada", texto: "¿Cuál es una característica fundamental de los microcréditos destinados a emprendedores con dificultades de acceso a la financiación tradicional?", opciones: [{ texto: "Requieren siempre garantías hipotecarias.", esCorrecta: false }, { texto: "Se basan más en la viabilidad del proyecto y la capacidad del emprendedor que en su historial crediticio o patrimonio previo.", esCorrecta: true }, { texto: "Tienen tipos de interés significativamente más altos que los préstamos comerciales.", esCorrecta: false }, { texto: "Solo se conceden a empresas ya consolidadas.", esCorrecta: false }] },
                { id: "gen_t8_p2", tema: 8, origen: "Generada", texto: "Al analizar una UTE (Unión Temporal de Empresas) para una financiación, es crucial entender que:", opciones: [{ texto: "Cada empresa miembro responde solo por su parte proporcional del proyecto.", esCorrecta: false }, { texto: "Generalmente, las empresas miembros responden solidaria e ilimitadamente frente a terceros por las obligaciones de la UTE.", esCorrecta: true }, { texto: "La UTE tiene personalidad jurídica propia e independiente de sus miembros a todos los efectos.", esCorrecta: false }, { texto: "La financiación de una UTE no aparece en la CIRBE de sus miembros.", esCorrecta: false }] },
                { id: "gen_t8_p3", tema: 8, origen: "Generada", texto: "El 'Ahorro Bruto' en la liquidación de un presupuesto municipal se calcula como:", opciones: [{ texto: "Total Ingresos menos Total Gastos.", esCorrecta: false }, { texto: "Ingresos Corrientes menos Gastos Corrientes.", esCorrecta: true }, { texto: "Ingresos de Capital menos Gastos de Capital.", esCorrecta: false }, { texto: "Ahorro Neto más amortización de la deuda.", esCorrecta: false }] },
                { id: "gen_t8_p4", tema: 8, origen: "Generada", texto: "¿Qué suele implicar una 'estructura de dominio recíproco múltiple' entre sociedades?", opciones: [{ texto: "Una sociedad holding que controla a todas las demás.", esCorrecta: false }, { texto: "Participaciones cruzadas entre varias sociedades sin que ninguna tenga el control mayoritario absoluto sobre las otras, creando un entramado complejo.", esCorrecta: true }, { texto: "Una estructura piramidal simple.", esCorrecta: false }, { texto: "Que todas las sociedades son filiales de una matriz extranjera.", esCorrecta: false }] },
                { id: "gen_t8_p5", tema: 8, origen: "Generada", texto: "La principal limitación de los microcréditos, en comparación con la financiación bancaria tradicional, suele ser:", opciones: [{ texto: "El plazo de devolución excesivamente largo.", esCorrecta: false }, { texto: "El importe máximo del crédito, que suele ser reducido.", esCorrecta: true }, { texto: "La exigencia de complejas garantías reales.", esCorrecta: false }, { texto: "La imposibilidad de destinarlos a actividades empresariales.", esCorrecta: false }] },
                { id: "gen_t8_p6", tema: 8, origen: "Generada", texto: "Según la definición de la UE, una 'microempresa' es aquella que, entre otros criterios:", opciones: [{ texto: "Factura más de 50 millones de euros.", esCorrecta: false }, { texto: "Ocupa a menos de 10 personas Y/O su volumen de negocios anual o su balance general anual no supera los 2 millones de euros.", esCorrecta: true }, { texto: "Tiene más de 250 empleados.", esCorrecta: false }, { texto: "Siempre cotiza en bolsa.", esCorrecta: false }] },
                { id: "gen_t8_p7", tema: 8, origen: "Generada", texto: "El 'cash flow libre' de una microempresa es un indicador de:", opciones: [{ texto: "Su beneficio contable exacto.", esCorrecta: false }, { texto: "Su capacidad para generar efectivo después de cubrir las inversiones necesarias para mantener su actividad y, por tanto, para atender el servicio de la deuda.", esCorrecta: true }, { texto: "El total de sus ventas al contado.", esCorrecta: false }, { texto: "El valor de sus activos líquidos.", esCorrecta: false }] },
                { id: "gen_t8_p8", tema: 8, origen: "Generada", texto: "En el análisis de riesgo de un ayuntamiento, ¿qué representa el 'Resultado Presupuestario Ajustado'?", opciones: [{ texto: "Los ingresos por impuestos directos.", esCorrecta: false }, { texto: "La diferencia entre derechos reconocidos netos y obligaciones reconocidas netas, ajustada por desviaciones de financiación.", esCorrecta: true }, { texto: "El nivel de endeudamiento total del ayuntamiento.", esCorrecta: false }, { texto: "El gasto en personal del ayuntamiento.", esCorrecta: false }] },
                { id: "gen_t8_p9", tema: 8, origen: "Generada", texto: "¿Por qué es importante analizar la coherencia entre la finalidad, el importe y el plazo en una solicitud de financiación de una microempresa?", opciones: [{ texto: "Porque la ley obliga a financiar cualquier finalidad.", esCorrecta: false }, { texto: "Para detectar posibles desviaciones de fondos o una estructura de financiación inadecuada para la necesidad real (ej. financiar activo fijo con un crédito a muy corto plazo).", esCorrecta: true }, { texto: "Solo es importante para grandes empresas.", esCorrecta: false }, { texto: "Para asegurar que el tipo de interés sea el más bajo posible.", esCorrecta: false }] },
                { id: "gen_t8_p10", tema: 8, origen: "Generada", texto: "La 'cobertura del FEI' (Fondo Europeo de Inversiones) en un microcrédito significa que:", opciones: [{ texto: "El FEI paga directamente el crédito al emprendedor.", esCorrecta: false }, { texto: "El FEI proporciona una garantía parcial a la entidad financiera que concede el microcrédito, mitigando parte del riesgo de insolvencia.", esCorrecta: true }, { texto: "El emprendedor no tiene que devolver el crédito si el proyecto fracasa.", esCorrecta: false }, { texto: "El tipo de interés del microcrédito está subvencionado por el FEI.", esCorrecta: false }] },

                // --- TEMA 9: Concesión de Operaciones al Sector Agrícola ---
                // From eva test.docx
                { id: "eva_t9_p1", tema: 9, origen: "eva test", texto: "Uno de los motivos por los que el porcentaje de financiación de una finca rústica suele ser inferior a los de cualquier inmovilizado, es:", opciones: [{ texto: "La existencia de muchas fincas donde poder efectuar la explotación del producto agrícola.", esCorrecta: false }, { texto: "El rápido deterioro en el valor de una finca que no se encuentre en explotación.", esCorrecta: true }, { texto: "Debido a la existencia de invernaderos, y la falta de estacionalidad de los productos agrícolas.", esCorrecta: false }, { texto: "El valor de compra venta de la finca, inferior al de otros inmuebles.", esCorrecta: false }] },
                { id: "eva_t9_p7", tema: 9, origen: "eva test", texto: "La Política Agrícola Comunitaria marcada desde el año 1.962, llevo en la década de los 1.980 a una:", opciones: [{ texto: "Aumento de la demanda de alimentos desde el exterior.", esCorrecta: false }, { texto: "Disminución de la tierra cultivada.", esCorrecta: false }, { texto: "Sobreproducción de alimentos.", esCorrecta: true }, { texto: "Crisis de consumo agrícola.", esCorrecta: false }] },

                // From Test Alberto.docx
                { id: "alb_t9_p1", tema: 9, origen: "Test Alberto", texto: "Un aspecto diferenciador de los socios cooperativistas con respecto de otras sociedades mercantiles es que:", opciones: [{ texto: "El socio no responde personalmente por las deudas sociales.", esCorrecta: false }, { texto: "La responsabilidad del socio se limita a su aportación de capital social.", esCorrecta: false }, { texto: "El socio responde ante la cooperativa por las pérdidas sufridas por esta una vez agotados los fondos de reserva.", esCorrecta: true }, { texto: "El socio lo puede ser por tiempo limitado o ilimitado según se determine.", esCorrecta: false }] },
                { id: "alb_t9_p5", tema: 9, origen: "Test Alberto", texto: "Las Sociedades Cooperativas:", opciones: [{ texto: "No tienen personalidad jurídica propia, aunque se rigen por sus propios estatutos.", esCorrecta: false }, { texto: "No tienen personalidad jurídica propia.", esCorrecta: false }, { texto: "Pueden tener personalidad jurídica, cuando todos sus miembros tengan personalidad jurídica.", esCorrecta: false }, { texto: "Tienen personalidad jurídica propia.", esCorrecta: true }] },

                // Generated for Tema 9
                { id: "gen_t9_p1", tema: 9, origen: "Generada", texto: "¿Qué son los 'derechos de Pago Básico' (o sus equivalentes) en el marco de la PAC?", opciones: [{ texto: "Derechos a obtener descuentos en insumos agrícolas.", esCorrecta: false }, { texto: "Ayudas directas desacopladas de la producción que perciben los agricultores que cumplen ciertos requisitos.", esCorrecta: true }, { texto: "Permisos para cultivar ciertos tipos de productos.", esCorrecta: false }, { texto: "Créditos blandos ofrecidos por la UE.", esCorrecta: false }] },
                { id: "gen_t9_p2", tema: 9, origen: "Generada", texto: "Al financiar la compra de insumos (fertilizantes, semillas) para una campaña agrícola, ¿cuál suele ser el plazo adecuado de financiación?", opciones: [{ texto: "Largo plazo (más de 5 años).", esCorrecta: false }, { texto: "Corto plazo, generalmente hasta la recolección y venta de la cosecha (menos de 1 año o hasta 18 meses en algunos casos).", esCorrecta: true }, { texto: "Mediano plazo (3-5 años).", esCorrecta: false }, { texto: "No se suelen financiar insumos.", esCorrecta: false }] },
                { id: "gen_t9_p3", tema: 9, origen: "Generada", texto: "El 'Fondo de Reserva Obligatorio' (FRO) en una sociedad cooperativa:", opciones: [{ texto: "Es totalmente repartible entre los socios cada año.", esCorrecta: false }, { texto: "Es un fondo irrepartible destinado a cubrir pérdidas y consolidar la estructura financiera de la cooperativa.", esCorrecta: true }, { texto: "Solo se constituye si la cooperativa tiene beneficios extraordinarios.", esCorrecta: false }, { texto: "Es reembolsable a los socios a su solicitud.", esCorrecta: false }] },
                { id: "gen_t9_p4", tema: 9, origen: "Generada", texto: "¿Qué es la 'aparcería' en el sector agrícola?", opciones: [{ texto: "Un tipo de maquinaria agrícola.", esCorrecta: false }, { texto: "Un contrato por el cual el propietario de una finca rústica cede su explotación a otra persona (aparcero) a cambio de una parte de los productos obtenidos.", esCorrecta: true }, { texto: "Una subvención de la PAC.", esCorrecta: false }, { texto: "Una cooperativa de segundo grado.", esCorrecta: false }] },
                { id: "gen_t9_p5", tema: 9, origen: "Generada", texto: "La estacionalidad es un factor clave en el análisis de riesgo del sector agrícola porque:", opciones: [{ texto: "Los agricultores solo trabajan en una estación del año.", esCorrecta: false }, { texto: "Afecta significativamente a los flujos de ingresos y gastos, concentrándose en periodos específicos del año.", esCorrecta: true }, { texto: "Solo afecta a cultivos de invernadero.", esCorrecta: false }, { texto: "La PAC solo se paga en una estación concreta.", esCorrecta: false }] },
                { id: "gen_t9_p6", tema: 9, origen: "Generada", texto: "Las cooperativas de segundo grado están formadas por:", opciones: [{ texto: "Agricultores individuales.", esCorrecta: false }, { texto: "Otras sociedades cooperativas.", esCorrecta: true }, { texto: "Empresas de servicios agrícolas.", esCorrecta: false }, { texto: "Administraciones públicas.", esCorrecta: false }] },
                { id: "gen_t9_p7", tema: 9, origen: "Generada", texto: "Al analizar las existencias de una cooperativa agrícola, es importante verificar que:", opciones: [{ texto: "Estén valoradas a precio de coste histórico, sin importar el precio de mercado.", esCorrecta: false }, { texto: "Estén valoradas a precio de mercado y no sobrevaloradas, considerando también su estado y la deuda pendiente de liquidar a los socios por esas entregas.", esCorrecta: true }, { texto: "Sean exclusivamente de la última cosecha.", esCorrecta: false }, { texto: "Cubran al menos el 200% de la deuda bancaria.", esCorrecta: false }] },
                { id: "gen_t9_p8", tema: 9, origen: "Generada", texto: "Un anticipo de la PAC (Política Agrícola Común) es una operación de financiación donde:", opciones: [{ texto: "El banco compra los derechos de la PAC al agricultor.", esCorrecta: false }, { texto: "El banco adelanta al agricultor una parte del importe de las ayudas que espera recibir de la PAC.", esCorrecta: true }, { texto: "La UE presta directamente al agricultor.", esCorrecta: false }, { texto: "Se financia la compra de nuevos derechos de la PAC.", esCorrecta: false }] },
                { id: "gen_t9_p9", tema: 9, origen: "Generada", texto: "¿Qué caracteriza al capital social de una cooperativa en cuanto a su transmisibilidad?", opciones: [{ texto: "Es libremente transmisible en el mercado de valores.", esCorrecta: false }, { texto: "Generalmente, las aportaciones no son libremente transmisibles a terceros ajenos a la cooperativa sin el consentimiento de esta, y su reembolso está sujeto a condiciones.", esCorrecta: true }, { texto: "Se representa mediante acciones al portador.", esCorrecta: false }, { texto: "No existe capital social, solo aportaciones voluntarias.", esCorrecta: false }] },
                { id: "gen_t9_p10", tema: 9, origen: "Generada", texto: "Un riesgo importante en la financiación de fincas rústicas, especialmente si no están en explotación, es:", opciones: [{ texto: "La alta liquidez de este tipo de activos.", esCorrecta: false }, { texto: "La dificultad para su valoración y la posible pérdida de valor o dificultades en su venta en caso de ejecución.", esCorrecta: true }, { texto: "La obligación de cultivarlas por parte del banco.", esCorrecta: false }, { texto: "La exención de impuestos asociada.", esCorrecta: false }] },

                // --- TEMA 10: Formalización, Seguimiento, Morosidad y Acción Recuperadora ---
                // From eva test.docx
                { id: "eva_t10_p1", tema: 10, origen: "eva test", texto: "Nuestro Comité de Créditos a autorizado una operación de préstamo a un cliente que nos lo había solicitado. A partir de aquí:", opciones: [{ texto: "Hemos asumido un compromiso de formalización y un riesgo cierto con el cliente.", esCorrecta: false }, { texto: "Hemos asumido un riesgo con el cliente.", esCorrecta: false }, { texto: "No asumimos ningún compromiso con el cliente pero si un riesgo.", esCorrecta: false }, { texto: "No hemos asumido ningún riesgo con el cliente hasta la formalización y posterior desembolso del efectivo.", esCorrecta: true }] }, // Nota: Esta respuesta puede ser debatible, pero según el test original [531] es la correcta. Desde una perspectiva de riesgo, la autorización ya implica una contingencia.
                { id: "eva_t10_p5", tema: 10, origen: "eva test", texto: "¿Qué etapa de Stage indica un riesgo fallido?", opciones: [{ texto: "Stage 2.", esCorrecta: false }, { texto: "Stage 1.", esCorrecta: false }, { texto: "Stage 3.", esCorrecta: false }, { texto: "Stage 5.", esCorrecta: true }] }, // Suponiendo que Stage 5 es la última y peor. Stage 3 IFRS9 es default.

                // From Test Alberto.docx
                { id: "alb_t10_p1", tema: 10, origen: "Test Alberto", texto: "¿Qué medida permite la reunificación de varias exposiciones en un solo préstamo?", opciones: [{ texto: "Consolidación de deudas.", esCorrecta: true }, { texto: "Modificación del calendario de amortización.", esCorrecta: false }, { texto: "Refinanciación de saldos vencidos.", esCorrecta: false }, { texto: "Reducción del tipo de interés.", esCorrecta: false }] },
                { id: "alb_t10_p14", tema: 10, origen: "Test Alberto", texto: "¿Qué fase del concurso implica la liquidación total de los activos del deudor?", opciones: [{ texto: "Fase Preventiva.", esCorrecta: false }, { texto: "Fase Convenio.", esCorrecta: false }, { texto: "Fase Liquidación.", esCorrecta: true }, { texto: "Fase Común.", esCorrecta: false }] },

                // Generated for Tema 10
                { id: "gen_t10_p1", tema: 10, origen: "Generada", texto: "La 'fase común' de un concurso de acreedores tiene como objetivo principal:", opciones: [{ texto: "Liquidar todos los activos del deudor inmediatamente.", esCorrecta: false }, { texto: "Determinar la masa activa (bienes y derechos del deudor) y la masa pasiva (lista de acreedores y cuantía de sus créditos).", esCorrecta: true }, { texto: "Negociar un convenio con los acreedores.", esCorrecta: false }, { texto: "Exonerar al deudor de todas sus deudas.", esCorrecta: false }] },
                { id: "gen_t10_p2", tema: 10, origen: "Generada", texto: "El 'bastanteo de poderes' en la formalización de un crédito a una persona jurídica es:", opciones: [{ texto: "La negociación final de las condiciones del crédito.", esCorrecta: false }, { texto: "La verificación por parte de la entidad (o sus asesores legales) de que la persona que firma en nombre de la sociedad tiene facultades suficientes y vigentes para obligarla.", esCorrecta: true }, { texto: "La inscripción del crédito en el Registro Mercantil.", esCorrecta: false }, { texto: "La tasación de las garantías aportadas.", esCorrecta: false }] },
                { id: "gen_t10_p3", tema: 10, origen: "Generada", texto: "Un 'procedimiento monitorio' es una vía judicial para:", opciones: [{ texto: "Declarar el concurso de acreedores de una empresa.", esCorrecta: false }, { texto: "Reclamar de forma ágil deudas dinerarias líquidas, determinadas, vencidas y exigibles, documentadas.", esCorrecta: true }, { texto: "Ejecutar una garantía hipotecaria.", esCorrecta: false }, { texto: "Resolver disputas contractuales complejas.", esCorrecta: false }] },
                { id: "gen_t10_p4", tema: 10, origen: "Generada", texto: "Según la normativa IFRS 9 (NIIF 9), un activo financiero entra en 'Stage 2' (incremento significativo del riesgo de crédito) cuando:", opciones: [{ texto: "El activo está en mora de más de 90 días.", esCorrecta: false }, { texto: "Ha habido un incremento significativo en el riesgo de incumplimiento desde el reconocimiento inicial, aunque no esté necesariamente en mora.", esCorrecta: true }, { texto: "El activo es de nueva concesión y tiene bajo riesgo.", esCorrecta: false }, { texto: "El activo se considera totalmente irrecuperable.", esCorrecta: false }] },
                { id: "gen_t10_p5", tema: 10, origen: "Generada", texto: "La 'dación en pago' en un préstamo hipotecario significa que:", opciones: [{ texto: "El banco condona una parte de la deuda y el cliente sigue pagando el resto.", esCorrecta: false }, { texto: "El deudor entrega el inmueble hipotecado al banco para saldar la totalidad de la deuda pendiente (si así se acuerda o lo permite la ley en ciertos casos).", esCorrecta: true }, { texto: "Se amplía el plazo del préstamo para reducir la cuota.", esCorrecta: false }, { texto: "Se vende el inmueble a un tercero con ayuda del banco.", esCorrecta: false }] },
                { id: "gen_t10_p6", tema: 10, origen: "Generada", texto: "Una 'quita' en el contexto de una reestructuración de deuda es:", opciones: [{ texto: "Un aumento del tipo de interés.", esCorrecta: false }, { texto: "Una condonación o perdón de una parte del principal o de los intereses de la deuda.", esCorrecta: true }, { texto: "Un período de carencia en el pago del principal.", esCorrecta: false }, { texto: "La aportación de nuevas garantías.", esCorrecta: false }] },
                { id: "gen_t10_p7", tema: 10, origen: "Generada", texto: "¿Cuál es el objetivo de la Ley de Segunda Oportunidad para personas físicas?", opciones: [{ texto: "Permitir a las empresas reestructurar sus deudas fácilmente.", esCorrecta: false }, { texto: "Ofrecer a deudores personas físicas de buena fe, bajo ciertas condiciones, la posibilidad de exonerar parte de sus deudas tras un procedimiento concursal y un plan de pagos o liquidación.", esCorrecta: true }, { texto: "Facilitar la obtención de nueva financiación sin analizar el riesgo.", esCorrecta: false }, { texto: "Proteger a los bancos de los impagos de particulares.", esCorrecta: false }] },
                { id: "gen_t10_p8", tema: 10, origen: "Generada", texto: "El 'seguimiento proactivo' del riesgo de crédito implica:", opciones: [{ texto: "Esperar a que el cliente incumpla para actuar.", esCorrecta: false }, { texto: "Revisar periódicamente la situación del acreditado y la evolución de su riesgo, anticipándose a posibles problemas.", esCorrecta: true }, { texto: "Contactar al cliente solo para venderle nuevos productos.", esCorrecta: false }, { texto: "Ignorar las alertas tempranas si el cliente paga puntualmente.", esCorrecta: false }] },
                { id: "gen_t10_p9", tema: 10, origen: "Generada", texto: "Antes de firmar una póliza de crédito, ¿qué debe verificar la entidad respecto a los firmantes en nombre de una sociedad?", opciones: [{ texto: "Su estado civil.", esCorrecta: false }, { texto: "Que sus poderes sean suficientes, estén vigentes y correctamente inscritos (si procede), y que no hayan sido revocados.", esCorrecta: true }, { texto: "Que sean accionistas mayoritarios.", esCorrecta: false }, { texto: "Su domicilio particular.", esCorrecta: false }] },
                { id: "gen_t10_p10", tema: 10, origen: "Generada", texto: "¿Qué es el 'default regulatorio' (o dudoso objetivo) según la EBA?", opciones: [{ texto: "Cualquier operación con más de 30 días de impago.", esCorrecta: false }, { texto: "Una situación donde una obligación crediticia material tiene más de 90 días de impago, o se considera improbable que el deudor pague sin recurrir a la ejecución de garantías.", esCorrecta: true }, { texto: "Cuando el cliente solicita una reestructuración.", esCorrecta: false }, { texto: "Cuando el rating del cliente baja un escalón.", esCorrecta: false }] }

            ];
        }
        
        let estadoActual = {
            vista: 'inicio', 
            modo: null, 
            temaActual: null, 
            examenActualId: null, 
            preguntasCuestionario: [], 
            preguntasCuestionarioRevisionEspecifica: [], 
            preguntaActualIdx: 0,
            respuestasUsuario: [], 
            puntuacion: 0,
            progresoGuardado: null,
            preguntaRespondidaEnSesion: false 
        };

        const appContainer = document.getElementById('app');

        function getItem(key) {
            try {
                const item = localStorage.getItem(`${appId}_${key}`);
                return item ? JSON.parse(item) : null;
            } catch (e) {
                console.error("Error al leer de localStorage:", key, e);
                return null;
            }
        }

        function setItem(key, value) {
            try {
                localStorage.setItem(`${appId}_${key}`, JSON.stringify(value));
            } catch (e) {
                console.error("Error al escribir en localStorage:", key, e);
                mostrarMensaje("Error al guardar progreso. Es posible que el almacenamiento esté lleno.", "error");
            }
        }

        function removeItem(key) {
            localStorage.removeItem(`${appId}_${key}`);
        }

        function renderizarVista() {
            appContainer.innerHTML = ''; 
            estadoActual.preguntaRespondidaEnSesion = false; 
            switch (estadoActual.vista) {
                case 'inicio':
                    renderizarInicio();
                    break;
                case 'seleccionTema':
                    renderizarSeleccionTema();
                    break;
                case 'cuestionario':
                    renderizarCuestionario();
                    break;
                case 'resultados':
                    renderizarResultados();
                    break;
                default:
                    renderizarInicio();
            }
        }

        function crearBoton(texto, onClick, clasesAdicionales = '') {
            const boton = document.createElement('button');
            boton.textContent = texto;
            boton.className = `bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out ${clasesAdicionales}`;
            boton.onclick = onClick;
            return boton;
        }
        
        function crearContenedorModal(titulo) {
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'modalOverlay';
            modalOverlay.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4';
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md transform transition-all scale-95 opacity-0 animate-modal-appear';
            modalContent.innerHTML = `<h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">${titulo}</h2>`;
            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 50);
            return modalContent;
        }

        function cerrarModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            if (modalOverlay) {
                const modalContent = modalOverlay.querySelector('div > div'); 
                 if (modalContent) {
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                }
                setTimeout(() => modalOverlay.remove(), 300); 
            }
        }

        async function verificarProgresoPrevio() {
            let progresoTemaMasReciente = null;
            for (let i = 1; i <= 10; i++) { 
                const progreso = getItem(`topicProgress_${i}`);
                if (progreso && (!progresoTemaMasReciente || new Date(progreso.lastAccessed) > new Date(progresoTemaMasReciente.lastAccessed))) {
                    progresoTemaMasReciente = {...progreso, id: String(i), tipo: 'tema'};
                }
            }
            let progresoExamenMasReciente = null;
            const examKeys = Object.keys(localStorage).filter(k => k.startsWith(`${appId}_examProgress_`));
            examKeys.forEach(key => {
                const progreso = getItem(key.substring(appId.length + 1)); 
                if (progreso && (!progresoExamenMasReciente || new Date(progreso.lastAccessed) > new Date(progresoExamenMasReciente.lastAccessed))) {
                    progresoExamenMasReciente = {...progreso, id: key.substring(appId.length + 1 + "examProgress_".length), tipo: 'examen'};
                }
            });
            
            let progresoParaContinuar = null;
            if (progresoTemaMasReciente && progresoExamenMasReciente) {
                progresoParaContinuar = new Date(progresoTemaMasReciente.lastAccessed) > new Date(progresoExamenMasReciente.lastAccessed) ? progresoTemaMasReciente : progresoExamenMasReciente;
            } else {
                progresoParaContinuar = progresoTemaMasReciente || progresoExamenMasReciente;
            }

            if (progresoParaContinuar && progresoParaContinuar.currentQuestionIndex > 0 && !progresoParaContinuar.completed) {
                estadoActual.progresoGuardado = progresoParaContinuar;
                mostrarModalContinuar();
            } else {
                renderizarVista(); 
            }
        }

        function mostrarModalContinuar() {
            const modalContent = crearContenedorModal("Continuar Sesión");
            const texto = document.createElement('p');
            texto.className = 'text-gray-700 mb-6 text-center';
            const nombreTemaGuardado = (estadoActual.progresoGuardado.tipo === 'tema' && TEMAS_NOMBRES[estadoActual.progresoGuardado.temaId - 1]) 
                ? TEMAS_NOMBRES[estadoActual.progresoGuardado.temaId - 1] 
                : `examen`;
            const tipo = estadoActual.progresoGuardado.tipo === 'tema' ? `el tema "${nombreTemaGuardado}"` : "un examen final";

            texto.textContent = `Hemos detectado un progreso guardado en ${tipo}. ¿Deseas continuar?`;
            modalContent.appendChild(texto);

            const btnContinuar = crearBoton('Sí, continuar', () => {
                continuarCuestionario();
                cerrarModal();
            }, 'bg-green-500 hover:bg-green-600 mr-2');
            
            const btnNuevo = crearBoton('No, empezar de nuevo', async () => {
                const idProgreso = estadoActual.progresoGuardado.tipo === 'tema' ? estadoActual.progresoGuardado.temaId : estadoActual.progresoGuardado.id;
                await limpiarProgreso(estadoActual.progresoGuardado.tipo, idProgreso);
                estadoActual.progresoGuardado = null;
                cerrarModal();
                renderizarVista(); 
            }, 'bg-red-500 hover:bg-red-600 ml-2');

            const divBotones = document.createElement('div');
            divBotones.className = 'flex justify-center mt-4';
            divBotones.appendChild(btnContinuar);
            divBotones.appendChild(btnNuevo);
            modalContent.appendChild(divBotones);
        }
        
        async function limpiarProgreso(tipo, id) {
            const key = tipo === 'tema' ? `topicProgress_${id}` : `examProgress_${id}`;
            removeItem(key);
            console.log(`Progreso de ${tipo} con ID ${id} eliminado.`);
        }

        function continuarCuestionario() {
            const progreso = estadoActual.progresoGuardado;
            estadoActual.modo = progreso.tipo;
            if (progreso.tipo === 'tema') {
                estadoActual.temaActual = progreso.temaId;
                estadoActual.preguntasCuestionario = shuffleArray([...preguntasGlobal.filter(p => p.tema === estadoActual.temaActual)]);
            } else { 
                estadoActual.examenActualId = progreso.id || progreso.examId; 
                if (progreso.questionsInExam && progreso.questionsInExam.length > 0) {
                    estadoActual.preguntasCuestionario = progreso.questionsInExam.map(qId => preguntasGlobal.find(p => p.id === qId)).filter(p => p);
                } else {
                    iniciarExamenFinal(true); 
                    return;
                }
            }
            estadoActual.preguntaActualIdx = progreso.currentQuestionIndex || 0;
            estadoActual.respuestasUsuario = progreso.userAnswers || [];
            estadoActual.puntuacion = progreso.score || 0;
            estadoActual.vista = 'cuestionario';
            renderizarVista();
        }

        function renderizarInicio() {
            appContainer.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white flex flex-col items-center justify-center p-6 font-inter">
                    <div class="bg-slate-800 p-8 sm:p-12 rounded-xl shadow-2xl text-center max-w-2xl w-full transform transition-all hover:scale-105 duration-300">
                        <h1 class="text-4xl sm:text-5xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">Plataforma de Estudio Interactivo</h1>
                        <p class="text-slate-300 mb-10 text-lg">Prepárate para tus exámenes de Riesgos Bancarios. Elige una opción para comenzar:</p>
                        <div id="botonesInicioContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                         <div id="botonBorrarDatosContainer" class="mt-10"></div>
                    </div>
                </div>
            `;

            const botonesContainer = document.getElementById('botonesInicioContainer');
            if (botonesContainer) {
                const btnRepasarTema = crearBoton('Repasar por Tema', () => { estadoActual.vista = 'seleccionTema'; renderizarVista(); }, 'w-full text-lg');
                const btnExamenFinal = crearBoton('Hacer Examen Final', () => iniciarExamenFinal(false), 'w-full text-lg');
                const btnRevisarFallos = crearBoton('Revisar Preguntas Falladas', iniciarRevisionFallos, 'w-full text-lg md:col-span-2');
                
                botonesContainer.appendChild(btnRepasarTema);
                botonesContainer.appendChild(btnExamenFinal);
                botonesContainer.appendChild(btnRevisarFallos);

            } else {
                console.error("El contenedor de botones 'botonesInicioContainer' no se encontró.");
            }

            const botonBorrarDatosContainer = document.getElementById('botonBorrarDatosContainer');
            if (botonBorrarDatosContainer) {
                const btnBorrarDatos = crearBoton('Borrar Todos los Datos Guardados', mostrarModalBorrarDatos, 'w-full sm:w-auto bg-red-700 hover:bg-red-800 text-sm');
                botonBorrarDatosContainer.appendChild(btnBorrarDatos);
            }
        }

        function mostrarModalBorrarDatos() {
            const modalContent = crearContenedorModal("Confirmar Borrado de Datos");
            const texto = document.createElement('p');
            texto.className = 'text-gray-700 mb-6 text-center';
            texto.textContent = "¿Estás seguro de que quieres borrar todos los datos guardados (progreso, exámenes, fallos)? Esta acción no se puede deshacer.";
            modalContent.appendChild(texto);

            const btnConfirmar = crearBoton('Sí, borrar todo', () => {
                borrarTodosLosDatos();
                cerrarModal();
                mostrarMensaje("Todos los datos guardados han sido borrados.", "success");
            }, 'bg-red-600 hover:bg-red-700 mr-2');
            
            const btnCancelar = crearBoton('Cancelar', cerrarModal, 'bg-gray-300 hover:bg-gray-400 text-gray-800 ml-2');

            const divBotones = document.createElement('div');
            divBotones.className = 'flex justify-center mt-4';
            divBotones.appendChild(btnConfirmar);
            divBotones.appendChild(btnCancelar);
            modalContent.appendChild(divBotones);
        }

        function borrarTodosLosDatos() {
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++){
                const key = localStorage.key(i);
                if (key && key.startsWith(appId + "_")) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            estadoActual = {
                vista: 'inicio',
                modo: null,
                temaActual: null,
                examenActualId: null,
                preguntasCuestionario: [],
                preguntaActualIdx: 0,
                respuestasUsuario: [],
                puntuacion: 0,
                progresoGuardado: null,
                preguntaRespondidaEnSesion: false
            };
            console.log("Todos los datos de localStorage para esta app borrados.");
            renderizarVista(); 
        }


        function renderizarSeleccionTema() {
            const temasUnicos = [...new Set(preguntasGlobal.map(p => p.tema))].sort((a,b) => a-b);
            appContainer.innerHTML = `
                <div class="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6 font-inter text-white">
                    <div class="bg-slate-800 p-8 sm:p-10 rounded-xl shadow-xl max-w-lg w-full">
                        <h2 class="text-3xl font-bold mb-8 text-center text-sky-400">Selecciona un Tema para Repasar</h2>
                        <div id="botonesTemaContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"></div>
                        <div id="botonVolverContainer"></div>
                    </div>
                </div>
            `;
            const botonesTemaContainer = document.getElementById('botonesTemaContainer');
            if (botonesTemaContainer) {
                temasUnicos.forEach(numTema => {
                    const nombreTema = TEMAS_NOMBRES[numTema - 1] || `Tema ${numTema}`;
                    const botonTema = crearBoton(nombreTema, () => iniciarCuestionarioTema(numTema, false), 'w-full bg-sky-600 hover:bg-sky-700');
                    botonesTemaContainer.appendChild(botonTema);
                });
            }
            const botonVolverContainer = document.getElementById('botonVolverContainer');
            if (botonVolverContainer) {
                 const botonVolver = crearBoton('Volver al Inicio', () => { estadoActual.vista = 'inicio'; renderizarVista(); }, 'w-full mt-4 bg-slate-600 hover:bg-slate-700');
                 botonVolverContainer.appendChild(botonVolver);
            }
        }
        
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        async function iniciarCuestionarioTema(numTema, omitirVerificacionProgreso = false) {
            estadoActual.modo = 'tema';
            estadoActual.temaActual = numTema;
            if (!omitirVerificacionProgreso) {
                const progresoGuardado = getItem(`topicProgress_${numTema}`);
                if (progresoGuardado && progresoGuardado.currentQuestionIndex > 0 && !progresoGuardado.completed) {
                    estadoActual.progresoGuardado = { ...progresoGuardado, temaId: numTema, tipo: 'tema', id: String(numTema) };
                    mostrarModalContinuar();
                    return; 
                }
            }
            estadoActual.preguntasCuestionario = shuffleArray([...preguntasGlobal.filter(p => p.tema === numTema)]);
            estadoActual.preguntaActualIdx = 0;
            estadoActual.respuestasUsuario = [];
            estadoActual.puntuacion = 0;
            estadoActual.vista = 'cuestionario';
            renderizarVista();
        }

        async function iniciarExamenFinal(omitirVerificacionProgreso = false) {
            estadoActual.modo = 'examen';
            if (!omitirVerificacionProgreso) {
                const examKeys = Object.keys(localStorage).filter(k => k.startsWith(`${appId}_examProgress_`));
                let examenEnCurso = null;
                for (const key of examKeys) {
                    const progreso = getItem(key.substring(appId.length + 1));
                    if (progreso && !progreso.completed && progreso.currentQuestionIndex > 0) {
                         if (!examenEnCurso || new Date(progreso.lastAccessed) > new Date(examenEnCurso.lastAccessed)) {
                            examenEnCurso = {...progreso, id: key.substring(appId.length + 1 + "examProgress_".length), tipo: 'examen'};
                        }
                    }
                }
                if (examenEnCurso) {
                    estadoActual.progresoGuardado = examenEnCurso;
                    mostrarModalContinuar();
                    return;
                }
            }
            let preguntasExamen = [];
            const preguntasPorTema = {};
            preguntasGlobal.forEach(p => {
                if (!preguntasPorTema[p.tema]) preguntasPorTema[p.tema] = [];
                preguntasPorTema[p.tema].push(p);
            });
            for (let i = 1; i <= 10; i++) { 
                if (preguntasPorTema[i]) {
                    const temaPreguntas = shuffleArray([...preguntasPorTema[i]]);
                    preguntasExamen.push(...temaPreguntas.slice(0, 10)); 
                }
            }
            estadoActual.preguntasCuestionario = shuffleArray(preguntasExamen.slice(0,100)); 
            estadoActual.preguntaActualIdx = 0;
            estadoActual.respuestasUsuario = [];
            estadoActual.puntuacion = 0;
            estadoActual.examenActualId = `examen_${Date.now()}`; 
            estadoActual.vista = 'cuestionario';
            renderizarVista();
        }
        
        async function iniciarRevisionFallos() {
            const idsFalladas = getItem('failedQuestions') || [];
            const preguntasFalladasCargadas = preguntasGlobal.filter(p => idsFalladas.includes(p.id));
            if (preguntasFalladasCargadas.length === 0) {
                mostrarMensaje("¡Felicidades! No tienes preguntas falladas para revisar.", "info");
                estadoActual.vista = 'inicio';
                renderizarVista();
                return;
            }
            estadoActual.preguntasCuestionario = shuffleArray(preguntasFalladasCargadas);
            estadoActual.modo = 'revision'; // Este es el modo "cuestionario de todos los fallos"
            estadoActual.preguntaActualIdx = 0;
            estadoActual.respuestasUsuario = []; 
            estadoActual.puntuacion = 0;
            estadoActual.vista = 'cuestionario'; 
            renderizarVista();
        }

        function renderizarCuestionario() {
            if (estadoActual.preguntasCuestionario.length === 0) {
                 const mensaje = estadoActual.modo === 'revision' ? "No hay preguntas falladas para revisar." : `No hay preguntas disponibles para este ${estadoActual.modo}.`;
                 const titulo = estadoActual.modo === 'revision' 
                    ? "Cuestionario de Preguntas Falladas" 
                    : (estadoActual.modo === 'revision_especifica' 
                        ? 'Revisión del Cuestionario Actual' 
                        : (estadoActual.modo === 'tema' ? TEMAS_NOMBRES[estadoActual.temaActual - 1] : 'Examen Final'));
                appContainer.innerHTML = `
                <div class="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6 text-white font-inter">
                    <div class="bg-slate-800 p-8 sm:p-10 rounded-xl shadow-xl text-center">
                        <h2 class="text-2xl font-bold mb-6">${titulo}</h2>
                        <p class="mb-6">${mensaje}</p>
                    </div>
                </div>`;
                const btnVolver = crearBoton('Volver al Inicio', () => { estadoActual.vista = 'inicio'; renderizarVista(); }, 'w-full mt-4');
                appContainer.querySelector('.bg-slate-800').appendChild(btnVolver);
                return;
            }

            const pregunta = estadoActual.preguntasCuestionario[estadoActual.preguntaActualIdx];
            const opcionesOriginales = pregunta.opciones;
            const opcionesAMostrar = estadoActual.modo === 'revision_especifica' ? opcionesOriginales : shuffleArray([...pregunta.opciones]); 

            const tituloCuestionario = estadoActual.modo === 'revision' 
                ? 'Cuestionario de Preguntas Falladas' 
                : (estadoActual.modo === 'revision_especifica'
                    ? 'Revisión de Fallos de Esta Sesión'
                    : (estadoActual.modo === 'tema' ? TEMAS_NOMBRES[estadoActual.temaActual - 1] : 'Examen Final'));

            appContainer.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white flex flex-col items-center justify-center p-4 sm:p-6 font-inter">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl sm:text-2xl font-semibold text-blue-400">${tituloCuestionario}</h2>
                            <span class="text-sm text-slate-400">Pregunta ${estadoActual.preguntaActualIdx + 1} de ${estadoActual.preguntasCuestionario.length}</span>
                        </div>
                        <div class="bg-slate-700 p-5 rounded-lg mb-6 min-h-[60px]">
                            <p class="text-lg sm:text-xl leading-relaxed">${pregunta.texto}</p>
                        </div>
                        <div id="opcionesCuestionarioContainer" class="mb-8"></div>
                        <div id="botonesCuestionarioContainer" class="flex flex-col sm:flex-row justify-between items-center gap-3"></div>
                        <div id="respuestaCorrectaContainer" class="mt-4 text-sm"></div>
                    </div>
                </div>
            `;

            const opcionesContainer = document.getElementById('opcionesCuestionarioContainer');
            opcionesAMostrar.forEach((op) => { // No necesitamos idxEnBarajadas aquí
                const indiceOriginal = opcionesOriginales.findIndex(o => o.texto === op.texto);
                const label = document.createElement('label');
                label.id = `opcion-label-${indiceOriginal}`; 
                label.className = "block bg-slate-700 hover:bg-slate-600 p-4 rounded-lg cursor-pointer transition duration-150 mb-3";
                const input = document.createElement('input');
                input.type = "radio";
                input.name = "opcion";
                input.value = indiceOriginal; 
                input.className = "sr-only peer";
                input.disabled = estadoActual.preguntaRespondidaEnSesion || estadoActual.modo === 'revision_especifica';
                
                input.onchange = () => { 
                    if (estadoActual.modo !== 'revision_especifica' && !estadoActual.preguntaRespondidaEnSesion) {
                        manejarSeleccionOpcion(indiceOriginal, pregunta); // Pasamos 'pregunta' en lugar de 'preguntaActual'
                    }
                };

                const span = document.createElement('span');
                span.className = "text-slate-200";
                span.textContent = op.texto;
                label.appendChild(input);
                label.appendChild(span);
                opcionesContainer.appendChild(label);
            });
            
            const botonesCuestionarioContainer = document.getElementById('botonesCuestionarioContainer');
            const btnSiguienteTexto = (estadoActual.modo === 'revision_especifica' || estadoActual.preguntaRespondidaEnSesion) ? 'Siguiente' : 'Saltar / Siguiente';
            const btnSiguiente = crearBoton(btnSiguienteTexto, manejarSiguientePregunta, 'w-full sm:w-auto');
            btnSiguiente.id = "btnSiguientePregunta";
            botonesCuestionarioContainer.appendChild(btnSiguiente);

            // Ajuste para el botón de terminar en modo 'revision_especifica'
            if (estadoActual.modo !== 'revision_especifica' || estadoActual.preguntaActualIdx < estadoActual.preguntasCuestionario.length - 1) {
                const btnTerminarTexto = (estadoActual.modo === 'revision' || estadoActual.modo === 'revision_especifica') ? 'Terminar Revisión' : 'Terminar Cuestionario';
                const btnTerminar = crearBoton(btnTerminarTexto, () => { 
                    estadoActual.vista = 'resultados'; 
                    renderizarResultados(); 
                }, 'w-full sm:w-auto bg-red-600 hover:bg-red-700');
                botonesCuestionarioContainer.appendChild(btnTerminar);
            }
            
            const respuestaCorrectaContainer = document.getElementById('respuestaCorrectaContainer');
            if (estadoActual.modo === 'revision_especifica' && pregunta.respuestaCorrectaTexto) {
                respuestaCorrectaContainer.innerHTML = `<div class="p-3 bg-green-800 border border-green-600 rounded-lg text-green-200"><strong>Respuesta Correcta:</strong> ${pregunta.respuestaCorrectaTexto}</div>`;
                const opcionCorrectaIdx = opcionesOriginales.findIndex(opt => opt.esCorrecta);
                if (opcionCorrectaIdx !== -1) {
                    const labelCorrecta = document.getElementById(`opcion-label-${opcionCorrectaIdx}`);
                    if (labelCorrecta) labelCorrecta.classList.add('!bg-green-700', 'ring-2', 'ring-green-500');
                }
                 // También marcar la seleccionada por el usuario si fue incorrecta
                const respuestaUsuario = estadoActual.respuestasUsuario.find(r => r.questionId === pregunta.id);
                if (respuestaUsuario && !respuestaUsuario.isCorrect) {
                    const labelSeleccionada = document.getElementById(`opcion-label-${respuestaUsuario.selectedOptionIndex}`);
                    if (labelSeleccionada) {
                        labelSeleccionada.classList.remove('bg-slate-700', 'hover:bg-slate-600');
                        labelSeleccionada.classList.add('!bg-red-700', 'ring-2', 'ring-red-500');
                    }
                }


            } else {
                respuestaCorrectaContainer.innerHTML = '';
            }
        }

        async function manejarSeleccionOpcion(indiceOpcionSeleccionada, preguntaActualObj) { // Renombrado el parámetro
            if (estadoActual.preguntaRespondidaEnSesion) return; 
            estadoActual.preguntaRespondidaEnSesion = true;

            const esCorrecta = preguntaActualObj.opciones[indiceOpcionSeleccionada].esCorrecta;
            const respuestaExistenteIdx = estadoActual.respuestasUsuario.findIndex(r => r.questionId === preguntaActualObj.id);

            if (respuestaExistenteIdx > -1) {
                estadoActual.respuestasUsuario[respuestaExistenteIdx] = { questionId: preguntaActualObj.id, selectedOptionIndex: indiceOpcionSeleccionada, isCorrect: esCorrecta };
            } else {
                estadoActual.respuestasUsuario.push({ questionId: preguntaActualObj.id, selectedOptionIndex: indiceOpcionSeleccionada, isCorrect: esCorrecta });
            }

            document.querySelectorAll('input[name="opcion"]').forEach(input => input.disabled = true);

            const labelSeleccionada = document.getElementById(`opcion-label-${indiceOpcionSeleccionada}`);
            const opcionCorrectaIdx = preguntaActualObj.opciones.findIndex(opt => opt.esCorrecta);
            const labelCorrecta = document.getElementById(`opcion-label-${opcionCorrectaIdx}`);

            if (esCorrecta) {
                if (labelSeleccionada) {
                    labelSeleccionada.classList.remove('bg-slate-700', 'hover:bg-slate-600');
                    labelSeleccionada.classList.add('!bg-green-600', 'ring-2', 'ring-green-400');
                }
                if (estadoActual.modo === 'revision') { // Solo quitar de fallos si estamos en el Cuestionario de Fallos
                    await quitarDeFalladas(preguntaActualObj.id);
                }
            } else {
                if (labelSeleccionada) {
                    labelSeleccionada.classList.remove('bg-slate-700', 'hover:bg-slate-600');
                    labelSeleccionada.classList.add('!bg-red-600', 'ring-2', 'ring-red-400');
                }
                if (labelCorrecta && opcionCorrectaIdx !== indiceOpcionSeleccionada) {
                    labelCorrecta.classList.remove('bg-slate-700', 'hover:bg-slate-600');
                    labelCorrecta.classList.add('!bg-green-600', 'ring-2', 'ring-green-400');
                }
                 // Añadir a falladas si no es modo revisión_específica (en modo revisión ya está en la lista)
                if (estadoActual.modo !== 'revision_especifica') {
                    await anadirAFalladas(preguntaActualObj);
                }
            }
            
            const btnSiguiente = document.getElementById("btnSiguientePregunta");
            if(btnSiguiente) btnSiguiente.textContent = "Siguiente";
        }
        
        async function manejarSiguientePregunta() {
            if (!estadoActual.preguntaRespondidaEnSesion && estadoActual.modo !== 'revision_especifica') {
                const preguntaActualObj = estadoActual.preguntasCuestionario[estadoActual.preguntaActualIdx];
                const respuestaExistenteIdx = estadoActual.respuestasUsuario.findIndex(r => r.questionId === preguntaActualObj.id);
                if (respuestaExistenteIdx > -1) {
                    estadoActual.respuestasUsuario[respuestaExistenteIdx] = { questionId: preguntaActualObj.id, selectedOptionIndex: -1, isCorrect: false };
                } else {
                    estadoActual.respuestasUsuario.push({ questionId: preguntaActualObj.id, selectedOptionIndex: -1, isCorrect: false });
                }
                 // Añadir a falladas si no es modo revisión_específica (en modo revisión ya está en la lista)
                if (estadoActual.modo !== 'revision_especifica') {
                    await anadirAFalladas(preguntaActualObj);
                }
            }

            estadoActual.preguntaRespondidaEnSesion = false; 
            estadoActual.preguntaActualIdx++;
            
            if (estadoActual.modo === 'tema' || estadoActual.modo === 'examen') {
                await guardarProgresoLocalStorage(); 
            }
            
            if (estadoActual.preguntaActualIdx < estadoActual.preguntasCuestionario.length) {
                if (estadoActual.modo === 'examen' && estadoActual.preguntaActualIdx % 20 === 0 && estadoActual.preguntaActualIdx > 0) {
                    mostrarEstadisticasParcialesExamen(); 
                } else {
                    renderizarCuestionario();
                }
            } else {
                estadoActual.vista = 'resultados';
                renderizarResultados();
            }
        }
        
        async function guardarProgresoLocalStorage() {
            const ahora = new Date().toISOString();
            let key;
            let progreso;

            if (estadoActual.modo === 'tema') {
                key = `topicProgress_${estadoActual.temaActual}`;
                progreso = {
                    temaId: estadoActual.temaActual,
                    currentQuestionIndex: estadoActual.preguntaActualIdx,
                    userAnswers: estadoActual.respuestasUsuario,
                    score: calcularPuntuacion(),
                    completed: estadoActual.preguntaActualIdx >= estadoActual.preguntasCuestionario.length,
                    lastAccessed: ahora 
                };
            } else if (estadoActual.modo === 'examen') {
                key = `examProgress_${estadoActual.examenActualId}`;
                progreso = {
                    examId: estadoActual.examenActualId,
                    currentQuestionIndex: estadoActual.preguntaActualIdx,
                    userAnswers: estadoActual.respuestasUsuario,
                    score: calcularPuntuacion(),
                    questionsInExam: estadoActual.preguntasCuestionario.map(p => p.id),
                    completed: estadoActual.preguntaActualIdx >= estadoActual.preguntasCuestionario.length,
                    lastAccessed: ahora
                };
            } 
            if(key && progreso) setItem(key, progreso);
        }

        function calcularPuntuacion() {
            return estadoActual.respuestasUsuario.filter(r => r.isCorrect).length;
        }
        
        function mostrarEstadisticasParcialesExamen() {
            const totalRespondidas = estadoActual.preguntaActualIdx;
            const respondidasEnEsteBloque = estadoActual.respuestasUsuario.slice(Math.max(0, totalRespondidas - 20), totalRespondidas);
            const correctasEnEsteBloque = respondidasEnEsteBloque.filter(r => r.isCorrect).length;
            const numPreguntasBloque = respondidasEnEsteBloque.length; 
            
            const modalContent = crearContenedorModal("Estadísticas Parciales del Examen");
            const texto = document.createElement('p');
            texto.className = 'text-gray-700 mb-4 text-lg text-left';
            texto.innerHTML = `Has completado ${totalRespondidas} de ${estadoActual.preguntasCuestionario.length} preguntas.<br>
                               En las últimas ${numPreguntasBloque} preguntas:<br>
                               Aciertos: ${correctasEnEsteBloque} de ${numPreguntasBloque}.<br>
                               Porcentaje: ${numPreguntasBloque > 0 ? ((correctasEnEsteBloque / numPreguntasBloque) * 100).toFixed(1) : 0}%`;
            modalContent.appendChild(texto);
            const btnContinuar = crearBoton('Continuar Examen', () => {
                cerrarModal();
                renderizarCuestionario(); 
            }, 'w-full mt-4');
            modalContent.appendChild(btnContinuar);
        }

        async function renderizarResultados() {
            const puntuacionFinal = calcularPuntuacion();
            const totalPreguntas = estadoActual.preguntasCuestionario.length;
            const porcentaje = totalPreguntas > 0 ? (puntuacionFinal / totalPreguntas * 100).toFixed(1) : 0;
            
            const ahora = new Date().toISOString();
            let keyToUpdate;
            let dataToUpdate;

            if (estadoActual.modo === 'tema' || estadoActual.modo === 'examen' || estadoActual.modo === 'revision') {
                const esCompletado = estadoActual.preguntaActualIdx >= estadoActual.preguntasCuestionario.length;
                if (estadoActual.modo === 'tema') {
                    keyToUpdate = `topicProgress_${estadoActual.temaActual}`;
                    dataToUpdate = { 
                        score: puntuacionFinal, completed: esCompletado, userAnswers: estadoActual.respuestasUsuario, 
                        lastAccessed: ahora, currentQuestionIndex: estadoActual.preguntaActualIdx 
                    };
                } else if (estadoActual.modo === 'examen') {
                     keyToUpdate = `examProgress_${estadoActual.examenActualId}`;
                     dataToUpdate = { 
                        score: puntuacionFinal, completed: esCompletado, userAnswers: estadoActual.respuestasUsuario,
                        questionsInExam: estadoActual.preguntasCuestionario.map(p => p.id), 
                        lastAccessed: ahora, currentQuestionIndex: estadoActual.preguntaActualIdx 
                    };
                } else if (estadoActual.modo === 'revision') {
                    // El quiz de revisión ya actualizó la lista global de fallos.
                }
                if (keyToUpdate && dataToUpdate) {
                    const progresoExistente = getItem(keyToUpdate) || {};
                    setItem(keyToUpdate, { ...progresoExistente, ...dataToUpdate });
                }
            }
            
            let tituloResultados;
            if (estadoActual.modo === 'revision') {
                tituloResultados = 'Resultados del Cuestionario de Fallos';
            } else if (estadoActual.modo === 'tema') {
                tituloResultados = `Resultados: ${TEMAS_NOMBRES[estadoActual.temaActual - 1]}`;
            } else { // examen
                tituloResultados = 'Resultados del Examen Final';
            }
            
            appContainer.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white flex flex-col items-center justify-center p-6 font-inter">
                    <div class="bg-slate-800 p-8 sm:p-12 rounded-xl shadow-2xl text-center max-w-md w-full">
                        <h2 class="text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">${tituloResultados}</h2>
                        <p class="text-xl mb-2">Tu puntuación en esta sesión: <span class="font-bold text-yellow-400">${puntuacionFinal} / ${totalPreguntas}</span></p>
                        <p class="text-xl mb-8">Porcentaje de aciertos: <span class="font-bold text-yellow-400">${porcentaje}%</span></p>
                        <div id="botonesResultadosContainer" class="space-y-4"></div>
                    </div>
                </div>
            `;

            const botonesResultadosContainer = document.getElementById('botonesResultadosContainer');
            if (botonesResultadosContainer) {
                if (totalPreguntas > 0) { 
                    const btnRevisarFallosSesion = crearBoton('Revisar Fallos de Esta Sesión', mostrarFallosDelCuestionarioActual, 'w-full bg-orange-500 hover:bg-orange-600');
                    botonesResultadosContainer.appendChild(btnRevisarFallosSesion);
                }
                const btnVolverInicio = crearBoton('Volver al Inicio', () => { estadoActual.vista = 'inicio'; renderizarVista(); }, 'w-full');
                botonesResultadosContainer.appendChild(btnVolverInicio);
            }
        }
        
        function mostrarFallosDelCuestionarioActual() {
            const falladasEsteCuestionario = estadoActual.respuestasUsuario
                .filter(r => !r.isCorrect)
                .map(r => r.questionId);
            
            const preguntasParaRevisar = estadoActual.preguntasCuestionario 
                .filter(p => falladasEsteCuestionario.includes(p.id))
                .map(p => { 
                    const opcionCorrecta = p.opciones.find(op => op.esCorrecta);
                    return {...p, respuestaCorrectaTexto: opcionCorrecta ? opcionCorrecta.texto : "No disponible"};
                });

            if (preguntasParaRevisar.length === 0) {
                mostrarMensaje("¡No tuviste errores en este cuestionario!", "info");
                return;
            }
            
            estadoActual.preguntasCuestionario = preguntasParaRevisar; // Cambiamos a las preguntas falladas de esta sesión
            estadoActual.modo = 'revision_especifica'; 
            estadoActual.preguntaActualIdx = 0;
            // No reseteamos respuestasUsuario aquí, ya que es solo para visualización
            estadoActual.vista = 'cuestionario';
            renderizarVista();
        }

        async function anadirAFalladas(pregunta) {
            if (!pregunta || !pregunta.id) return;
            let idsFalladas = getItem('failedQuestions') || [];
            if (!idsFalladas.includes(pregunta.id)) {
                idsFalladas.push(pregunta.id);
                setItem('failedQuestions', idsFalladas);
            }
        }

        async function quitarDeFalladas(questionId) {
            if (!questionId) return;
            let idsFalladas = getItem('failedQuestions') || [];
            idsFalladas = idsFalladas.filter(id => id !== questionId);
            setItem('failedQuestions', idsFalladas);
        }
        
        function mostrarMensaje(mensaje, tipo = 'info', duracion = 3000) {
            const mensajeDiv = document.createElement('div');
            mensajeDiv.textContent = mensaje;
            let bgColorClass = 'bg-blue-500';
            if (tipo === 'error') bgColorClass = 'bg-red-600';
            if (tipo === 'success') bgColorClass = 'bg-green-600';
            mensajeDiv.className = `fixed bottom-5 right-5 ${bgColorClass} text-white py-3 px-5 rounded-lg shadow-xl text-sm z-50 transform transition-all animate-toast-in`;
            document.body.appendChild(mensajeDiv);
            setTimeout(() => {
                mensajeDiv.classList.remove('animate-toast-in');
                mensajeDiv.classList.add('animate-toast-out');
                setTimeout(() => mensajeDiv.remove(), 500);
            }, duracion);
        }

        async function inicializarApp() {
            await cargarPreguntas(); 
            await verificarProgresoPrevio(); 
        }
        
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes modal-appear {
                from { transform: scale(0.95); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            .animate-modal-appear { animation: modal-appear 0.3s ease-out forwards; }
            @keyframes toast-in {
                from { transform: translateY(100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            .animate-toast-in { animation: toast-in 0.5s ease-out forwards; }
            @keyframes toast-out {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            .animate-toast-out { animation: toast-out 0.5s ease-in forwards; }
        `;
        document.head.appendChild(styleSheet);

        inicializarApp();

    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-900">
    <div id="app">
        <div class="min-h-screen flex items-center justify-center text-white">Cargando aplicación...</div>
    </div>
</body>
</html>
